{
  "createdAt": "2025-10-30T15:52:31.741Z",
  "updatedAt": "2025-11-30T17:52:02.000Z",
  "id": "4aBnRQs0MwFenQHE",
  "name": "New qualifying system",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        160,
        -48
      ],
      "id": "6432ff91-d88a-4a3c-9132-2b06f443d4ea",
      "name": "Wait1",
      "webhookId": "276e07ca-2322-48b6-8e36-806c955f3128"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "085371f4-fb8c-4ed1-a697-92ebd9e53bdd",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -272,
        -48
      ],
      "id": "8a051c79-49eb-46ae-bd48-df5b3f445242",
      "name": "Linkedin DM",
      "webhookId": "085371f4-fb8c-4ed1-a697-92ebd9e53bdd"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "eb727470-16e7-43f4-9524-032d69df5e56",
              "name": "body.sender.attendee_name",
              "value": "={{ $json.body.sender.attendee_name }}",
              "type": "string"
            },
            {
              "id": "07f0795d-3ac1-42c2-b043-38cde86cf88f",
              "name": "body.sender.attendee_profile_url",
              "value": "={{ $json.body.sender.attendee_profile_url }}",
              "type": "string"
            },
            {
              "id": "f86e54a0-bfe0-47b5-a54b-562e066df588",
              "name": "body.message",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "eb2b63a7-c2dd-4fec-ac79-bbb2ba64f845",
              "name": "body.sender.attendee_provider_id",
              "value": "={{ $json.body.sender.attendee_provider_id }}",
              "type": "string"
            },
            {
              "id": "f473a900-3cd4-4c6c-a5a2-5d2b6b0be477",
              "name": "direction",
              "value": "Incoming",
              "type": "string"
            },
            {
              "id": "84a17055-5d48-4749-9d02-c01e386ec1c9",
              "name": "Timestamp",
              "value": "={{$now.toLocaleString(\"en-IN\", { timeZone: \"Asia/Kolkata\" })}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -48,
        -48
      ],
      "id": "f95b1a5a-60c6-485e-a78d-a0bb0cee1bd0",
      "name": "Edit req fields from Linkedin dm"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api9.unipile.com:13982/api/v1/chats",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "2Kp+I9QKk.tQLnUEMxmdyQSHkuo8kmgC9mOx/LUIJDfGCz02RArbk="
            },
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "account_id",
              "value": "={{ $json['Sender ID'] }}"
            },
            {
              "name": "text",
              "value": "={{ $('Code in JavaScript9').item.json.latest_message }}"
            },
            {
              "name": "attendees_ids",
              "value": "={{ $json['Sender ID'] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3056,
        -64
      ],
      "id": "2d501ce4-c724-499d-9780-f4b1236ff308",
      "name": "Send reply back in Linkedin"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        784,
        160
      ],
      "id": "93b89022-18b2-40ca-a3fa-d328256fd84f",
      "name": "Google Gemini Chat Model7",
      "credentials": {
        "googlePalmApi": {
          "id": "Gq3qNdXZmlzVb7Jg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_provider_id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        928,
        160
      ],
      "id": "8c2cb8ed-4611-4753-96f0-d2ce37bd178f",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.conversation_log }},{{ $('Edit req fields from Linkedin dm').first().json.body.message }}",
        "options": {
          "systemMessage": "=You are an AI Assistant for **Lumoscale** â€” an AI Automation Agency that helps coaches automate lead generation, outreach, and onboarding using smart systems.\n\nYour job is to reply naturally to incoming **LinkedIn messages** on behalf of the founder of Lumoscale.  \nYou must sound friendly, conversational, and human â€” never robotic, formal, or salesy.  \nWhile replying, you also need to **qualify the lead** subtly based on their tone, problem, and readiness.\n\nYou will receive:\n- conversation_log â†’ previous messages  \n- new_message â†’ latest incoming message  \n\n---\n\n### ðŸ“¥ Input\n**Conversation so far:**  \n{{ $json.conversation_log }}\n\n**Current user message:**  \n{{ $('Edit req fields from Linkedin dm').first().json.body.message }}\n\n---\n\n### ðŸŽ¯ Your Objectives\n1. Reply casually like a real person â€” short, natural, and friendly.  \n2. Identify the intent (Greeting / Inquiry / Problem / Call / Objection / Other).  \n3. Qualify the lead â€” understand their pain, mindset, and readiness level.  \n4. Never send booking or website links directly.  \n   - If they seem like a **hot lead** (strong interest, urgency, ownership), ask for their **email** instead and mention that the founder will send details there.  \n5. Always return a **fully complete JSON output** â€” with no null, undefined, or missing fields.  \n   - If unsure, use fallback text like `\"Unknown\"` or `\"Not yet identified\"`.  \n\n---\n\n### ðŸ’¬ Response Rules\n\n1. **If the user greets (hi, hello, hey, etc.)**  \n   â†’ â€œHey! Haha great to connect ðŸ‘‹ Howâ€™s everything going on your side?â€\n\n2. **If they ask what Lumoscale does**  \n   â†’ â€œWe help coaches automate lead generation, outreach, and onboarding â€” so you can focus more on actual coaching instead of daily busywork.â€\n\n3. **If they mention a problem or frustration**  \n   â†’ â€œTotally get that â€” happens with a lot of coaches haha. Whatâ€™s been your biggest challenge lately?â€\n\n4. **If they ask about help, pricing, or getting started**  \n   â†’ â€œThatâ€™s awesome ðŸ˜„ Before we go further, could you please share your email? The founder will send you a short overview and next steps there.â€\n\n5. **If they give unclear or random messages**  \n   â†’ â€œHaha got it ðŸ˜„ could you tell me what kind of help youâ€™re looking for â€” lead generation, onboarding, or something else?â€\n\n6. **If they say â€˜not readyâ€™, â€˜no budgetâ€™, or â€˜laterâ€™**  \n   â†’ â€œTotally fair! Timingâ€™s everything haha. Would you like me to share a quick example of how other coaches automated their process?â€\n\n---\n\n### ðŸ”¥ Lead Qualification Logic\n\nWhile replying, infer these based on tone and context:\n\n- **Problem Summary** â†’ What issue they seem to face or describe  \n- **Need Type** â†’ Lead generation, onboarding, scaling, or unknown  \n- **Readiness Level** â†’ Hot (ready to act), Warm (curious/interested), Cold (not urgent), Unknown  \n- **Lead Score** â†’ Numeric value 1â€“5 (5 = high intent, 1 = low intent)  \n- **Coach Notes** â†’ Suggest what the founder should do next (e.g., â€œAsk for emailâ€, â€œContinue conversationâ€, â€œNurture laterâ€)  \n\nIf any field is missing, use safe defaults such as `\"Not yet identified\"` or `\"Unknown\"`.\n\n---\n\n### ðŸ§© Output Format\nReturn only valid JSON (no extra text or code blocks).  \nEvery field must always be filled â€” never null or undefined.\n\n\n{\n  \"reply\": \"[Your message in natural human tone]\",\n  \"intent\": \"[Greeting / Inquiry / Problem / Objection / Call / Other]\",\n  \"confidence\": \"[High / Medium / Low]\",\n  \"next_action\": \"[Ask Email / Continue Chat / Qualify Lead / Wait]\",\n  \"lead_summary\": {\n    \"Problem Summary\": \"[If not found, write 'Not yet identified']\",\n    \"Need Type\": \"[If unclear, write 'Unknown']\",\n    \"Readiness Level\": \"[If unclear, write 'Unknown']\",\n    \"Lead Score\": \"[Always output 1â€“5; default = 1]\",\n    \"Coach Notes\": \"[If unclear, write 'Not enough info yet']\"\n  }\n}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        800,
        -48
      ],
      "id": "f55d4113-3dcf-4eca-8bc3-d6ecaed139f0",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1472294070,
          "mode": "list",
          "cachedResultName": "Convo Linkedin",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1472294070"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "ID",
              "lookupValue": "={{ $json.body.sender.attendee_provider_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        384,
        -48
      ],
      "id": "d8d52dc1-defa-42c9-aaa0-ee466845e9e5",
      "name": "Get row(s) in sheet2",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  let raw = item.json.output || \"\";\n\n  // Clean response text\n  raw = raw.replace(/```json|```/g, \"\").replace(/\\n/g, \" \").trim();\n\n  // Safe JSON parsing\n  let data = {};\n  try {\n    data = JSON.parse(raw);\n  } catch (e) {\n    item.json.error = \"Invalid JSON format\";\n    continue;\n  }\n\n  // Helper function to clean strings\n  const clean = (str) => (str || \"\").toString().replace(/\\n/g, \" \").trim() || \"Unknown\";\n\n  // Assign top-level fields\n  item.json.reply = clean(data.reply);\n  item.json.intent = clean(data.intent);\n  item.json.confidence = clean(data.confidence);\n  item.json.next_action = clean(data.next_action);\n\n  // Handle lead_summary safely\n  const summary = data.lead_summary || {};\n  item.json.problem_summary = clean(summary[\"Problem Summary\"]);\n  item.json.need_type = clean(summary[\"Need Type\"]);\n  item.json.readiness_level = clean(summary[\"Readiness Level\"]);\n  item.json.lead_score = clean(summary[\"Lead Score\"]);\n  item.json.coach_notes = clean(summary[\"Coach Notes\"]);\n\n  // Fallback in case JSON is incomplete\n  if (!item.json.reply) item.json.reply = \"No valid reply generated\";\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1136,
        -48
      ],
      "id": "d9724984-7f75-4fb0-b3d4-7d39ee2c3596",
      "name": "Code in JavaScript6",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "const rows = $input.all().map(item => item.json);\n\n// Sort messages by row number (just in case)\nrows.sort((a, b) => a.row_number - b.row_number);\n\n// Take the last 5 messages\nconst lastFive = rows.slice(-5);\n\n// Join only the message text (comma-separated)\nconst convo = lastFive\n  .map(m => `${m.Convo || \"\"}`)\n  .join(\", \");\n\nreturn [{\n  json: {\n    conversation_log: convo || \"No previous messages\",\n    sender_profile_url: rows[0]?.Url || \"\",\n    sender_id: rows[0]?.ID || \"\"\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        -48
      ],
      "id": "e00f57a8-50ce-494b-b2cb-31253a138a7a",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Edit Fields4').first().json.body.entry[0].messaging[0].sender.id }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        720,
        -944
      ],
      "id": "7e567013-d442-4f83-a63d-ce5e1b7ed581",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 954419306,
          "mode": "list",
          "cachedResultName": "Instagram",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=954419306"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Sender ID": "={{ $('Code in JavaScript8').item.json.sender_id }}",
            "Text": "={{ $('Instagram DMs').first().json.body.entry[0].messaging[0].message.text }}",
            "Date": "={{ $now.toLocaleString('en-IN', { timeZone: 'Asia/Calcutta' }) }}",
            "problem_summary": "={{ $('Code in JavaScript8').item.json.problem_summary }}",
            "need_type": "={{ $('Code in JavaScript8').item.json.need_type }}",
            "lead_score": "={{ $('Code in JavaScript8').item.json.lead_score }}",
            "Lead Stage": "={{ $('Code in JavaScript8').item.json.lead_stage }}",
            "reason": "={{ $('Code in JavaScript8').item.json.reason }}",
            "coach_notes": "={{ $('Code in JavaScript8').item.json.coach_notes }}"
          },
          "matchingColumns": [
            "Sender ID"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender ID",
              "displayName": "Sender ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Text",
              "displayName": "Text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "problem_summary",
              "displayName": "problem_summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "need_type",
              "displayName": "need_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "lead_score",
              "displayName": "lead_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Lead Stage",
              "displayName": "Lead Stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reason",
              "displayName": "reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "coach_notes",
              "displayName": "coach_notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2048,
        -1152
      ],
      "id": "fa4993b4-efcd-44b3-8113-1b9eec9ed795",
      "name": "Append Instagram Sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1589942840,
          "mode": "list",
          "cachedResultName": "Convo history(insta)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1589942840"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sender_id": "={{ $('Code in JavaScript5').item.json.sender_id }}",
            "conversation_history": "={{ $('Code in JavaScript4').item.json.reply }}"
          },
          "matchingColumns": [
            "sender_id"
          ],
          "schema": [
            {
              "id": "sender_id",
              "displayName": "sender_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "conversation_history",
              "displayName": "conversation_history",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1840,
        -1152
      ],
      "id": "051c0218-37a2-44f8-812e-48608c9df2d3",
      "name": "Append row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let rows = $input.all().map(item => item.json);\n\n// If Google Sheets has data, use it\nif (rows.length > 0 && rows[0].sender_id) {\n\n  rows.sort((a, b) => (a.row_number || 0) - (b.row_number || 0));\n  const lastFive = rows.slice(-5);\n\n  const conversation = lastFive\n    .map((msg, i) => `Message ${i + 1}: ${msg.conversation_history}`)\n    .join(\"\\n\");\n\n  return [{\n    json: {\n      source: \"google_sheet\",\n      sender_id: rows[0].sender_id,\n      conversation_log: conversation,\n      last_5_messages: lastFive\n    }\n  }];\n\n}\n\n// Fallback: use Edit Fields4 (first message)\nconst fallback = $node[\"Edit Fields4\"].json;\n\n// Correct object access\nconst senderId = fallback.body.entry[0].messaging[0].sender.id;\nconst messageText = fallback.body.entry[0].messaging[0].message.text;\n\nreturn [{\n  json: {\n    source: \"instagram_dm\",\n    sender_id: senderId,\n    conversation_log: `Message 1: ${messageText}`,\n    last_5_messages: [\n      { conversation_history: messageText }\n    ]\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        480,
        -1152
      ],
      "id": "b2ca2ed6-5d9b-481d-bd08-6118beec9485",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6bd88b13-825f-4c9e-bce8-a45d423433db",
              "name": "body.entry[0].messaging[0].sender.id",
              "value": "={{ $json.body.entry[0].messaging[0].sender.id }}",
              "type": "string"
            },
            {
              "id": "c95fbccd-0bc0-438b-8d67-4d9c9de62d41",
              "name": "body.entry[0].messaging[0].message.text",
              "value": "={{ $json.body.entry[0].messaging[0].message.text }}",
              "type": "string"
            },
            {
              "id": "397a18db-5a5b-419a-a8c1-d606d623e1cc",
              "name": "direction",
              "value": "Incoming",
              "type": "string"
            },
            {
              "id": "dd49e08a-ae00-4f37-b2d2-c1459c904725",
              "name": "timestamp",
              "value": "={{ $now.toLocaleString(\"en-IN\", { timeZone: \"Asia/Kolkata\" }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        96,
        -1152
      ],
      "id": "5756b8e7-2325-4081-a1fc-763f4c8aecb5",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  let raw = item.json.output || \"\";\n\n  // Clean and sanitize raw AI response\n  raw = raw.replace(/```json|```/g, \"\").replace(/\\n/g, \" \").trim();\n\n  // Try parsing JSON safely\n  let data = {};\n  try {\n    data = JSON.parse(raw);\n  } catch (e) {\n    item.json.error = \"Invalid JSON format\";\n    continue;\n  }\n\n  // Helper function to clean text\n  const clean = (str) => (str || \"\").toString().replace(/\\n/g, \" \").trim();\n\n  // Extract main response\n  item.json.reply = clean(data.reply);\n  item.json.intent = clean(data.intent);\n  item.json.confidence = clean(data.confidence);\n  item.json.next_action = clean(data.next_action);\n\n  // Extract nested lead summary (if available)\n  const lead = data.lead_summary || {};\n  item.json.problem_summary = clean(lead[\"Problem Summary\"]);\n  item.json.need_type = clean(lead[\"Need Type\"]);\n  item.json.readiness_level = clean(lead[\"Readiness Level\"]);\n  item.json.lead_score = clean(lead[\"Lead Score\"]);\n  item.json.coach_notes = clean(lead[\"Coach Notes\"]);\n\n  // Add clean formatted summary for debugging/logs\n  item.json.summary_text = `\n    Reply: ${item.json.reply}\n    Intent: ${item.json.intent}\n    Lead Score: ${item.json.lead_score}\n    Problem: ${item.json.problem_summary}\n  `.trim();\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1024,
        -1152
      ],
      "id": "85dcd16e-fbc1-4f74-ae60-e2f586f81c13",
      "name": "Code in JavaScript4",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1589942840,
          "mode": "list",
          "cachedResultName": "Convo history(insta)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1589942840"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "sender_id",
              "lookupValue": "={{ $json.body.entry[0].messaging[0].sender.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        288,
        -1152
      ],
      "id": "3f46a887-94c4-4cbd-b8da-4a5a36a2da01",
      "name": "Get row(s) in sheet",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.conversation_log }}, {{ $('Edit Fields4').first().json.body.entry[0].messaging[0].message.text }}",
        "options": {
          "systemMessage": "=# Lumoscale Chat and Lead Qualification AI Prompt\n\nYou are a Lead Qualification and Chat Assistant for Lumoscale.  \nYou chat like a real human and qualify people in the background.\n\nYour job is to:\n- Sound friendly and natural\n- Hold short, warm conversations\n- Understand their problem and intent\n- Quietly qualify them without sounding salesy\n- Never show analysis\n- Always reply in JSON only\n\n---\n\n## INPUT YOU WILL RECEIVE\n\nYou will receive:\n\nconversation_log â†’ Past messages  \nnew_message â†’ Latest user message  \n\nConversation so far:\n{{ $json.conversation_log }}\n\nNew message:\n{{ $('Edit Fields4').first().json.body.entry[0].messaging[0].message.text }}\n\n---\n\n## HOW TO THINK QUIETLY\n\nWhile chatting, evaluate:\n\n- How clear they are\n- How serious they sound\n- How emotionally invested they are\n- Whether they are ready for action\n- Whether this is a real business need\n\nThen convert that into internal signals:\n\n- Problem Summary  \n- Need Type  \n- Readiness Level  \n- Lead Score  \n- Coach Notes  \n\nNever show these thoughts to the user.\n\n---\n\n## REPLY STYLE RULES\n\nWrite like a real person sending texts:\n\n- Short messages\n- Simple words\n- Natural tone\n- Tiny casual phrases like \"haha\" or \"got you\"\n- A maximum of 2 emojis\n- Never sound corporate or robotic\n- Always end with a soft question\n\n---\n\n## WHAT TO SAY BY SITUATION\n\n### If they greet:\nExample:\n\"Hey nice to connect ðŸ‘‹ how is your day going haha\"\n\n---\n\n### If they ask what Lumoscale does:\nExample:\n\"I help coaches save time by automating the boring stuff like leads and onboarding so they can focus on coaching. What part are you trying to improve right now\"\n\n---\n\n### If they mention a problem:\nExample:\n\"I get you, that stuff gets heavy fast. What part feels the most annoying right now\"\n\n---\n\n### If message is unclear:\nExample:\n\"Haha got you. What are you trying to fix or improve in your workflow right now\"\n\n---\n\n### If they say no budget or not ready:\nExample:\n\"Totally fair, timing matters. Want a small free example you can try later\"\n\n---\n\n### If they show interest in a call:\nExample:\n\"Nice, happy to chat through this with you. If you want, you can grab a quick spot here and we go deeper ðŸ‘‰ https://cal.com/yourlink\"\n\n---\n\n## LEAD QUALIFICATION RULES (INTERNAL)\n\n### Confidence Score\n- High â†’ clear problem + urgency\n- Medium â†’ curious, unsure\n- Low â†’ vague or casual\n\n### Lead Score\n- 1 â†’ random or early browsing\n- 2 â†’ light curiosity\n- 3 â†’ real but slow\n- 4 â†’ strong interest\n- 5 â†’ wants action now\n\n### Readiness Level\n- Unknown â†’ no signal yet\n- Exploring â†’ learning mode\n- Interested â†’ open to help\n- Ready â†’ wants results now\n\n---\n\n## OUTPUT FORMAT (STRICT JSON)\n\nAlways return full JSON. Never leave fields empty.\n\n```json\n{\n  \"reply\": \"\",\n  \"intent\": \"Greeting or Inquiry or Problem or Objection or Call or Other\",\n  \"confidence\": \"High or Medium or Low\",\n  \"next_action\": \"Ask More or Qualify Lead or Wait\",\n  \"lead_summary\": {\n    \"Problem Summary\": \"\",\n    \"Need Type\": \"mindset or business or clarity or strategy or Unknown\",\n    \"Readiness Level\": \"Exploring or Interested or Ready or Unknown\",\n    \"Lead Score\": \"1\",\n    \"Coach Notes\": \"\"\n  }\n}\n```\n\n---\n\n## COMPLETE REAL-WORLD EXAMPLES\n\n### Example 1: Greeting Only\n\nUser: \"Hey\"\n\nOutput:\n```json\n{\n  \"reply\": \"Hey nice to connect ðŸ‘‹ how is your day going haha\",\n  \"intent\": \"Greeting\",\n  \"confidence\": \"Low\",\n  \"next_action\": \"Ask More\",\n  \"lead_summary\": {\n    \"Problem Summary\": \"Not yet identified\",\n    \"Need Type\": \"Unknown\",\n    \"Readiness Level\": \"Unknown\",\n    \"Lead Score\": \"1\",\n    \"Coach Notes\": \"Not enough info\"\n  }\n}\n```\n\n---\n\n### Example 2: Asking About Lumoscale\n\nUser: \"What do you do exactly?\"\n\nOutput:\n```json\n{\n  \"reply\": \"I help coaches automate leads and onboarding so things run smoother. What part are you trying to improve right now\",\n  \"intent\": \"Inquiry\",\n  \"confidence\": \"Medium\",\n  \"next_action\": \"Qualify Lead\",\n  \"lead_summary\": {\n    \"Problem Summary\": \"Looking for automation help\",\n    \"Need Type\": \"strategy\",\n    \"Readiness Level\": \"Exploring\",\n    \"Lead Score\": \"2\",\n    \"Coach Notes\": \"Early stage, ask about pain\"\n  }\n}\n```\n\n---\n\n### Example 3: Expressing Frustration\n\nUser: \"I struggle with getting clients\"\n\nOutput:\n```json\n{\n  \"reply\": \"Yeah that part is rough ðŸ˜… what has been the toughest thing about getting clients so far\",\n  \"intent\": \"Problem\",\n  \"confidence\": \"Medium\",\n  \"next_action\": \"Qualify Lead\",\n  \"lead_summary\": {\n    \"Problem Summary\": \"Struggling to get clients\",\n    \"Need Type\": \"business\",\n    \"Readiness Level\": \"Interested\",\n    \"Lead Score\": \"3\",\n    \"Coach Notes\": \"Probe deeper into lead generation\"\n  }\n}\n```\n\n---\n\n### Example 4: Ready for a Call\n\nUser: \"Can we talk about this?\"\n\nOutput:\n```json\n{\n  \"reply\": \"Yeah for sure, happy to go deeper with you. You can grab a quick slot here whenever works ðŸ‘‰ https://cal.com/yourlink\",\n  \"intent\": \"Call\",\n  \"confidence\": \"High\",\n  \"next_action\": \"Qualify Lead\",\n  \"lead_summary\": {\n    \"Problem Summary\": \"Wants direct guidance\",\n    \"Need Type\": \"strategy\",\n    \"Readiness Level\": \"Ready\",\n    \"Lead Score\": \"5\",\n    \"Coach Notes\": \"Send calendar link and move to call\"\n  }\n}\n```\n\n---\n\n### Example 5: Not Ready / No Budget\n\nUser: \"Not ready to spend right now\"\n\nOutput:\n```json\n{\n  \"reply\": \"No stress at all, timing matters. Want a small example you can try first\",\n  \"intent\": \"Objection\",\n  \"confidence\": \"Low\",\n  \"next_action\": \"Wait\",\n  \"lead_summary\": {\n    \"Problem Summary\": \"Budget hesitation\",\n    \"Need Type\": \"mindset\",\n    \"Readiness Level\": \"Exploring\",\n    \"Lead Score\": \"2\",\n    \"Coach Notes\": \"Nurture with free value\"\n  }\n}\n```\n\n---\n\n## FINAL RULES\n\n- Always reply in JSON only  \n- Always include all fields  \n- Never sound like a bot  \n- Always ask one soft question  \n- Never expose logic  \n- Never return null values  \n- Keep replies short  \n- Friendly tone always  \n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        704,
        -1152
      ],
      "id": "5bd2f037-6f6e-4479-af1d-a42e0e333b2d",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "multipleMethods": true,
        "httpMethod": [
          "POST",
          "GET"
        ],
        "path": "Instagram-dm",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -160,
        -1056
      ],
      "id": "014a24cb-d2e1-4a39-b705-c9e1ef0042d7",
      "name": "Instagram DMs",
      "webhookId": "8f3ef1ea-5ba5-454b-a611-f0a53df234fd"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.query['hub.challenge'] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        80,
        -896
      ],
      "id": "f3e7b6b4-f6d7-46d5-8f8c-a894fc3efa28",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        592,
        -944
      ],
      "id": "0b069b94-d419-4532-993c-a30cd29072a2",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "Gq3qNdXZmlzVb7Jg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const results = [];\n\nfor (const item of $input.all()) {\n\n  // Correctly read AI response\n  let raw =\n    item.json.content?.parts?.[0]?.text ||\n    item.json.message?.content ||\n    item.json.message ||\n    \"\";\n\n  try {\n    // Remove markdown wrappers\n    let clean = raw.replace(/```json|```/g, \"\").trim();\n\n    // Parse JSON\n    const data = JSON.parse(clean);\n\n    // Store clean values\n    results.push({\n      json: {\n        lead_stage: data.lead_stage || \"Unqualified\",\n        reason: data.reason || \"No reason returned\",\n        confidence: data.confidence || \"Low\"\n      }\n    });\n\n  } catch (err) {\n\n    // Fallback if parsing fails\n    results.push({\n      json: {\n        lead_stage: \"Unqualified\",\n        reason: \"Invalid JSON from AI\",\n        confidence: \"Low\"\n      }\n    });\n\n  }\n}\n\nreturn results;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1616,
        -1152
      ],
      "id": "5067b4bc-ad8e-4072-8b29-a85b7ee77447",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.instagram.com/v24.0/me/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer IGAANy9Ku2eeZABZAFNlQlBJQ1J2aTFLRmRaTjdTdTZANdS1KdW9MTkhnZAHhVeUFYX0k4U1gxQlpabU4zQURuR2RpcG1HNDByUHl3N2FMZA0FJUjlCeEMxUzZAKb1NGeTlNREdZASHQ4a2RJLW5fcHMydlFkS1h2TEF0Q3Rja01aUGluSQZDZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('Edit Fields4').item.json.body.entry[0].messaging[0].sender.id }}\"\n  },\n  \"message\": {\n    \"text\": \"{{ $('Code in JavaScript4').item.json.reply }}\"\n  },\n  \"messaging_type\": \"RESPONSE\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2240,
        -1152
      ],
      "id": "0bc839d3-618d-48a2-9f05-ffffec78f207",
      "name": "Send reply back in Instagram"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4.1-mini-2025-04-14",
          "mode": "list",
          "cachedResultName": "GPT-4.1-MINI-2025-04-14"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a **Lead Qualification AI Assistant for LinkedIn DMs** that thinks like an experienced **Automation Strategist for Coaches**.  \nYour role is to help **Lumoscale** identify truly qualified leads â€” based not only on what they say, but on their tone, clarity, mindset, and readiness to act.  \n\nYou will receive structured data about a lead:  \n\n{\n  \"sender_id\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_provider_id }}\",\n  \"Name\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_name }}\",\n  \"URL\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_profile_url }}\",\n  \"conversation_log\": \"{{ $('Code in JavaScript7').item.json.conversation_log }}\",\n  \"latest_message\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.message }}\",\n  \"problem_summary\": \"{{ $json.problem_summary }}\",\n  \"need_type\": \"{{ $json.need_type }}\",\n  \"readiness_level\": \"{{ $json.readiness_level }}\",\n  \"lead_score\": \"{{ $json.lead_score }}\",\n  \"coach_notes\": \"{{ $json.coach_notes }}\"\n}\n\n---\n\n### ðŸ§  Your Task:\nEvaluate the lead **like a LinkedIn growth strategist who understands coaching and automation**.  \nYour goal is to analyze how serious, self-aware, and ready the lead is to solve their business problem with automation.\n\nAssess the following **5 layers of qualification**:\n\n1. **Pain Clarity** â€“ Is the business problem specific (manual tasks, low conversion, no system) or vague?  \n2. **Ownership Level** â€“ Are they proactive about fixing it or blaming tools, team, or time?  \n3. **Solution Desire** â€“ Do they want automation help now, or just exploring ideas?  \n4. **Decision Readiness** â€“ Are they actively seeking a solution or passively curious?  \n5. **Professional Fit** â€“ Are they a coach, consultant, or business owner (Lumoscaleâ€™s target)?  \n\n---\n\n### ðŸ”¥ Classification\n\n**HOT LEAD:**  \n- Speaks with clarity about inefficiencies or scaling pain.  \n- Wants results fast and is ready to act.  \n- Already using tools or open to systems/automation.  \n- Shows professional tone and interest in taking next step.  \n\n**WARM LEAD:**  \n- Understands automation benefits but not urgent.  \n- Curious about what Lumoscale offers.  \n- Can be nurtured through use cases, examples, or follow-ups.  \n\n**COLD LEAD:**  \n- Vague about goals or pain.  \n- Mentions no urgency or â€œlaterâ€ mindset.  \n- Needs education or awareness before conversion.  \n\n**UNQUALIFIED LEAD:**  \n- Irrelevant industry, unclear messages, or spam.  \n- No link to coaching, business, or automation needs.  \n\n---\n\n### ðŸŽ¯ Output (strictly in JSON)\n\n{\n  \"sender_id\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_provider_id }}\",\n  \"Name\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_name }}\",\n  \"URL\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_profile_url }}\",\n  \"latest_message\": \"{{ $('Edit req fields from Linkedin dm').first().json.body.message }}\",\n  \"problem_summary\": \"{{ $json.problem_summary }}\",\n  \"need_type\": \"{{ $json.need_type }}\",\n  \"lead_score\": \"{{ $json.lead_score }}\",\n  \"lead_stage\": \"[Hot / Warm / Cold / Unqualified]\",\n  \"reason\": \"[2â€“3 lines combining emotional and logical reasoning for classification â€” mention tone, mindset, and intent clues.]\",\n  \"coach_notes\": \"[Give 1 actionable suggestion for Lumoscaleâ€™s founder â€” e.g., ask follow-up question, offer email for overview, or nurture with automation example.]\"\n}\n\n---\n\nThink like a **LinkedIn Business Coach**, not a bot â€” combine **business insight, emotional intelligence, and lead psychology**  \nto help Lumoscale focus only on **high-intent, automation-ready leads** who are serious about growth.\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1328,
        -48
      ],
      "id": "277b81fb-80a8-4df9-9907-03a2a2ff21ef",
      "name": "Message a model5",
      "credentials": {
        "openAiApi": {
          "id": "8cTwctTGeEBOJeUq",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  let raw = item.json.message?.content || item.json.message || \"\";\n\n  try {\n    // Clean up extra formatting like ```json ... ```\n    const clean = raw.replace(/```json|```/g, \"\").trim();\n\n    // Parse JSON output from AI\n    const data = JSON.parse(clean);\n\n    // Extract required fields safely\n    item.json.sender_id = data.sender_id?.toString().trim() || \"Unknown\";\n    item.json.Name = data.Name?.toString().trim() || \"Unknown\";\n    item.json.URL = data.URL?.toString().trim() || \"Unknown\";\n    item.json.latest_message = data.latest_message?.toString().trim() || \"No message\";\n    item.json.problem_summary = data.problem_summary?.toString().trim() || \"Not specified\";\n    item.json.need_type = data.need_type?.toString().trim() || \"Unknown\";\n    item.json.lead_score = data.lead_score?.toString().trim() || \"1\";\n    item.json.lead_stage = data.lead_stage?.toString().trim() || \"Unqualified\";\n    item.json.reason = data.reason?.toString().trim() || \"No reason given\";\n    item.json.coach_notes = data.coach_notes?.toString().trim() || \"No notes yet\";\n  } catch (e) {\n    item.json.error = \"Invalid JSON format\";\n  }\n}\n\nreturn $input.all().map(item => ({\n  json: {\n    sender_id: item.json.sender_id,\n    Name: item.json.Name,\n    URL: item.json.URL,\n    latest_message: item.json.latest_message,\n    problem_summary: item.json.problem_summary,\n    need_type: item.json.need_type,\n    lead_score: item.json.lead_score,\n    lead_stage: item.json.lead_stage,\n    reason: item.json.reason,\n    coach_notes: item.json.coach_notes\n  }\n}));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1664,
        -48
      ],
      "id": "789041c8-62f2-4d82-938e-bc000792346d",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1472294070,
          "mode": "list",
          "cachedResultName": "Convo Linkedin",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1472294070"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $json.Name }}",
            "Url": "={{ $json.URL }}",
            "Convo": "={{ $json.latest_message }}"
          },
          "matchingColumns": [
            "sender_id"
          ],
          "schema": [
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Url",
              "displayName": "Url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Convo",
              "displayName": "Convo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1872,
        -48
      ],
      "id": "3e673a76-8fc5-4ef1-ab41-ad15c7af04b0",
      "name": "Append row in sheet5",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1989579242,
          "mode": "list",
          "cachedResultName": "Linkedin",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1989579242"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Date": "={{ $now.toLocaleString('en-IN', { timeZone: 'Asia/Calcutta' }) }}",
            "Sender ID": "={{ $('Code in JavaScript9').item.json.sender_id }}",
            "Name": "={{ $json.Name }}",
            "URL": "={{ $('Code in JavaScript9').item.json.URL }}",
            "need_type": "={{ $('Code in JavaScript9').item.json.need_type }}",
            "lead_score": "={{ $('Code in JavaScript9').item.json.lead_score }}",
            "Lead Stage": "={{ $('Code in JavaScript9').item.json.lead_stage }}",
            "reason": "={{ $('Code in JavaScript9').item.json.reason }}",
            "coach_notes": "={{ $('Code in JavaScript9').item.json.coach_notes }}",
            "problem_summary": "={{ $('Code in JavaScript9').item.json.problem_summary }}",
            "Text": "={{ $('Code in JavaScript9').item.json.latest_message }}",
            "Email": "-"
          },
          "matchingColumns": [
            "Sender ID"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Sender ID",
              "displayName": "Sender ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "URL",
              "displayName": "URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Text",
              "displayName": "Text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "problem_summary",
              "displayName": "problem_summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "need_type",
              "displayName": "need_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "lead_score",
              "displayName": "lead_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Lead Stage",
              "displayName": "Lead Stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reason",
              "displayName": "reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "coach_notes",
              "displayName": "coach_notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2096,
        -48
      ],
      "id": "46060607-a057-48c1-8de4-d45ebe0a72e3",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4.1-mini-2025-04-14",
          "mode": "list",
          "cachedResultName": "GPT-4.1-MINI-2025-04-14"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a simple text prompter.\n\nYour goal: Check if the user has shared an email address in the input text.\n\nRules:\n- If the text contains a valid email address, output only the email address.\n- If no email is found, output exactly: no email\n- Do not include explanations, punctuation, or extra text.\n\nInput:\n{{ $json.Text }}\n\nOutput:\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        2272,
        -48
      ],
      "id": "34cfdecd-cc96-44d2-833a-a143d9b727d0",
      "name": "Message a model7",
      "credentials": {
        "openAiApi": {
          "id": "8cTwctTGeEBOJeUq",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e38784bd-9d96-4fda-8b5b-d54e52c127e5",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "no email",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2560,
        -48
      ],
      "id": "46864678-fcb0-4f89-93e3-f7a8716b07f6",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1989579242,
          "mode": "list",
          "cachedResultName": "Linkedin",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1989579242"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Sender ID": "={{ $('Edit req fields from Linkedin dm').first().json.body.sender.attendee_provider_id }}",
            "Email": "={{ $json.message.content }}"
          },
          "matchingColumns": [
            "Sender ID"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Sender ID",
              "displayName": "Sender ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "URL",
              "displayName": "URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Text",
              "displayName": "Text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "problem_summary",
              "displayName": "problem_summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "need_type",
              "displayName": "need_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "lead_score",
              "displayName": "lead_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Lead Stage",
              "displayName": "Lead Stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "reason",
              "displayName": "reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "coach_notes",
              "displayName": "coach_notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2848,
        -64
      ],
      "id": "9a55b76c-ec0a-42cc-ad50-64fde1148f24",
      "name": "Append or update row in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "content": "# Instagram DM ChatBot",
        "height": 896,
        "width": 3568,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -320,
        -1504
      ],
      "typeVersion": 1,
      "id": "8e5dcac3-ff37-42fc-b93a-de842a2024ff",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# Linkedin DM ChatBot",
        "height": 624,
        "width": 3584,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -336,
        -240
      ],
      "typeVersion": 1,
      "id": "3acbabc5-537c-4b93-bc62-7932fd9f665c",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "formTitle": "Trusted by coaches and agencies",
        "formDescription": "Free audit done by automation experts",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Name",
              "placeholder": "Enter your name",
              "requiredField": true
            },
            {
              "fieldLabel": "Email",
              "placeholder": "Enter your email",
              "requiredField": true
            },
            {
              "fieldLabel": "Whatsapp number",
              "fieldType": "number",
              "placeholder": "Number",
              "requiredField": true
            },
            {
              "fieldLabel": "Business type",
              "requiredField": true
            },
            {
              "fieldLabel": "Monthly revenue range",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "2k"
                  },
                  {
                    "option": "3k"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "What's your biggest challenge right now?",
              "placeholder": "Message",
              "requiredField": true
            },
            {
              "fieldLabel": "How soon do you want to solve this",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "Immediate"
                  },
                  {
                    "option": "Week later"
                  },
                  {
                    "option": "month later"
                  },
                  {
                    "option": "Not urgent"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "What is your biggest goal in the next 90 days",
              "requiredField": true
            }
          ]
        },
        "options": {
          "appendAttribution": false,
          "buttonLabel": "Book a Call",
          "ignoreBots": true,
          "customCss": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n<title>Lumoscale Lead Form</title>\n<style>\n:root {\n\t--font-family: 'Open Sans', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 600;\n\t--font-size-body: 14px;\n\t--font-size-label: 14px;\n\t--font-size-header: 20px;\n\t--color-background: #fbfcfe;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #dbdfe7;\n\t--color-card-shadow: rgba(99, 77, 255, 0.06);\n\t--color-header: #525356;\n\t--color-label: #555555;\n\t--color-input-border: #dbdfe7;\n\t--color-input-text: #333;\n\t--color-focus-border: #5a4cc2;\n\t--color-submit-btn-bg: #ff6d5a;\n\t--color-submit-btn-text: #ffffff;\n\t--color-html-link: #ff6d5a;\n\t--color-error: #ea1f30;\n\t--border-radius-card: 8px;\n\t--border-radius-input: 6px;\n\t--box-shadow-card: 0 6px 18px var(--color-card-shadow);\n}\n\nbody {\n\tfont-family: var(--font-family);\n\tbackground: var(--color-background);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tmin-height: 100vh;\n\tpadding: 20px;\n}\n\n.form-card {\n\tbackground: var(--color-card-bg);\n\tborder: 1px solid var(--color-card-border);\n\tbox-shadow: var(--box-shadow-card);\n\tborder-radius: var(--border-radius-card);\n\twidth: 100%;\n\tmax-width: 420px;\n\tpadding: 32px;\n}\n\n.form-header {\n\ttext-align: center;\n\tcolor: var(--color-header);\n\tfont-size: var(--font-size-header);\n\tfont-weight: var(--font-weight-bold);\n\tmargin-bottom: 12px;\n}\n\n.form-subtext {\n\ttext-align: center;\n\tcolor: #7e8186;\n\tfont-size: 13px;\n\tmargin-bottom: 24px;\n}\n\n.form-group {\n\tmargin-bottom: 16px;\n}\n\nlabel {\n\tdisplay: block;\n\tmargin-bottom: 6px;\n\tcolor: var(--color-label);\n\tfont-size: var(--font-size-label);\n}\n\ninput, textarea, select {\n\twidth: 100%;\n\tpadding: 12px;\n\tborder: 1px solid var(--color-input-border);\n\tborder-radius: var(--border-radius-input);\n\tfont-size: var(--font-size-body);\n\tcolor: var(--color-input-text);\n\tbackground-color: #fff;\n\ttransition: border 0.3s;\n}\n\ninput:focus, textarea:focus, select:focus {\n\toutline: none;\n\tborder-color: var(--color-focus-border);\n\tbox-shadow: 0 0 0 3px rgba(90, 76, 194, 0.1);\n}\n\nbutton {\n\twidth: 100%;\n\tbackground: var(--color-submit-btn-bg);\n\tcolor: var(--color-submit-btn-text);\n\tpadding: 14px;\n\tfont-size: var(--font-size-label);\n\tfont-weight: var(--font-weight-bold);\n\tborder: none;\n\tborder-radius: var(--border-radius-input);\n\tcursor: pointer;\n\ttransition: 0.3s;\n}\n\nbutton:hover {\n\tbackground: #ff543e;\n}\n\nfooter {\n\ttext-align: center;\n\tmargin-top: 16px;\n\tfont-size: 12px;\n\tcolor: #888;\n}\n</style>\n</head>\n<body>\n\n<div class=\"form-card\">\n\t<h2 class=\"form-header\">Get Your Free Automation Audit</h2>\n\t<p class=\"form-subtext\">See how we can automate your lead generation, qualification, and onboarding.</p>\n\t\n\t<form>\n\t\t<div class=\"form-group\">\n\t\t\t<label for=\"name\">Full Name</label>\n\t\t\t<input type=\"text\" id=\"name\" placeholder=\"Enter your name\" required>\n\t\t</div>\n\n\t\t<div class=\"form-group\">\n\t\t\t<label for=\"email\">Email</label>\n\t\t\t<input type=\"email\" id=\"email\" placeholder=\"Enter your email\" required>\n\t\t</div>\n\n\t\t<div class=\"form-group\">\n\t\t\t<label for=\"business\">Business Type / Niche</label>\n\t\t\t<select id=\"business\">\n\t\t\t\t<option value=\"\">Select...</option>\n\t\t\t\t<option>Coach / Consultant</option>\n\t\t\t\t<option>Agency Owner</option>\n\t\t\t\t<option>Real Estate</option>\n\t\t\t\t<option>Law / Legal</option>\n\t\t\t\t<option>Other</option>\n\t\t\t</select>\n\t\t</div>\n\n\t\t<div class=\"form-group\">\n\t\t\t<label for=\"pain\">Biggest Challenge Right Now</label>\n\t\t\t<textarea id=\"pain\" rows=\"3\" placeholder=\"E.g., Too many unqualified leads or missed follow-ups\"></textarea>\n\t\t</div>\n\n\t\t<button type=\"submit\">Submit</button>\n\t</form>\n\n\t<footer>Powered by Lumoscale Automations</footer>\n</div>\n\n</body>\n</html>\n"
        }
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        -4784,
        -1792
      ],
      "id": "8888e18a-19c0-404a-9ce6-e2d2807cd736",
      "name": "Website Signup or Webinar Signup",
      "webhookId": "4be5de2b-37e1-4104-949c-1f34b061df64"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "323ad272-08e7-462f-9774-efe6946dfba0",
              "leftValue": "={{ $json.Email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3104,
        -1792
      ],
      "id": "6e426493-4611-422a-87e0-9842069e38b2",
      "name": "If duplicates Found vs Not Found"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Form",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Email",
              "lookupValue": "={{ $json.Email }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3328,
        -1792
      ],
      "id": "c289fcc9-f567-4e47-ba13-faf0aa97379f",
      "name": "Check duplicates",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8b3ce1dd-7bf9-4a69-ac98-e11ab5b5050a",
              "name": "Name",
              "value": "={{ $json.Name }}",
              "type": "string"
            },
            {
              "id": "167f58be-18af-4382-94b6-b7b8d73ad2a2",
              "name": "Email",
              "value": "={{ $json.Email }}",
              "type": "string"
            },
            {
              "id": "8da05d43-4e19-4bb7-bc4a-3650033986ba",
              "name": "Whatsapp number",
              "value": "={{ $json['Whatsapp number'] }}",
              "type": "number"
            },
            {
              "id": "e9afaa00-8635-4999-87c7-3846579abee2",
              "name": "Business type",
              "value": "={{ $json['Business type'] }}",
              "type": "string"
            },
            {
              "id": "18952807-fab2-4977-af47-3621f832c6af",
              "name": "Monthly revenue range",
              "value": "={{ $json['Monthly revenue range'] }}",
              "type": "string"
            },
            {
              "id": "08bd423a-9935-4938-9751-9d945f56d8f6",
              "name": "What's your biggest challenge right now?",
              "value": "={{ $json['What\\'s your biggest challenge right now?'] }}",
              "type": "string"
            },
            {
              "id": "d05a24f1-bd9d-4aa8-8e6f-c7cba26cd843",
              "name": "How soon do you want to solve this",
              "value": "={{ $json['How soon do you want to solve this'] }}",
              "type": "string"
            },
            {
              "id": "654eec57-8fcd-4da2-9cc0-6d0dbf3e8e74",
              "name": "What is your biggest goal in the next 90 days",
              "value": "={{ $json['What is your biggest goal in the next 90 days'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4560,
        -1792
      ],
      "id": "5aa826f1-0db4-4448-af89-6472fdba8f38",
      "name": "Edit Req Fields for Form"
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n\n  // Read AI output safely\n  let raw = item.json.content?.parts?.[0]?.text || item.json.message || \"\";\n\n  // Parse JSON\n  let data = {};\n  try {\n    data = JSON.parse(raw);\n  } catch (e) {\n    console.error(\"Invalid JSON format\");\n  }\n\n  // Overwrite output with clean structured fields only\n  item.json = {\n    core_pain: data.CorePain || \"\",\n    need_type: data.NeedType || \"\",\n    emotion: data.Emotion || \"\",\n    pain_intensity: data.PainIntensity || 0,\n    committed_words: data.CommittedWordsCount || 0,\n    urgency_flag: data.UrgencyFlag || false,\n    action_words: data.ActionWordsCount || 0,\n    victim_language: data.VictimLanguage || false,\n    revenue_score: data.RevenueScore || 0,\n    intent_score: data.IntentScore || 0,\n    clarity_score: data.ClarityScore || 0,\n    goal_quality_score: data.GoalQualityScore || 0,\n    coach_notes: data.Notes || \"\"\n  };\n\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3920,
        -1792
      ],
      "id": "ed257682-96b8-4907-902b-d0d0c9354b99",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2350c7a9-6b70-4dfb-90ba-2bfa6ca37f4d",
              "name": "core_pain",
              "value": "={{ $json.core_pain }}",
              "type": "string"
            },
            {
              "id": "2dd8e177-b39f-4c5a-a069-1a9858b7a256",
              "name": "need_type",
              "value": "={{ $json.need_type }}",
              "type": "string"
            },
            {
              "id": "7870b5d9-604c-44b7-917b-d6874c195a79",
              "name": "emotion",
              "value": "={{ $json.emotion }}",
              "type": "string"
            },
            {
              "id": "c2870d81-c2f7-4fcc-86d4-d27e995475b7",
              "name": "pain_intensity",
              "value": "={{ $json.pain_intensity }}",
              "type": "number"
            },
            {
              "id": "6e689456-24f1-434b-8d8e-5231e9b70d65",
              "name": "committed_words",
              "value": "={{ $json.committed_words }}",
              "type": "number"
            },
            {
              "id": "6bc3eebc-d1d6-4acb-b997-4637db34a7dd",
              "name": "urgency_flag",
              "value": "={{ $json.urgency_flag }}",
              "type": "boolean"
            },
            {
              "id": "5f6a6aaa-2478-438c-9866-ecae53619494",
              "name": "action_words",
              "value": "={{ $json.action_words }}",
              "type": "number"
            },
            {
              "id": "42f98ec6-22d4-4e50-aa53-07233b8c59b2",
              "name": "victim_language",
              "value": "={{ $json.victim_language }}",
              "type": "boolean"
            },
            {
              "id": "acf95a6f-bed0-4768-b81b-8b1fcc6f22d4",
              "name": "revenue_score",
              "value": "={{ $json.revenue_score }}",
              "type": "number"
            },
            {
              "id": "a3fbe06c-c4c3-4659-a6ef-94f8b0a15535",
              "name": "intent_score",
              "value": "={{ $json.intent_score }}",
              "type": "number"
            },
            {
              "id": "78ba03ff-a05c-4832-963b-dd121eac1277",
              "name": "clarity_score",
              "value": "={{ $json.clarity_score }}",
              "type": "number"
            },
            {
              "id": "9110624c-e8aa-4e0d-87f1-c39e8d8eaabb",
              "name": "goal_quality_score",
              "value": "={{ $json.goal_quality_score }}",
              "type": "number"
            },
            {
              "id": "98fe0447-52e1-449a-b9f0-ca131d3576a8",
              "name": "coach_notes",
              "value": "={{ $json.coach_notes }}",
              "type": "string"
            },
            {
              "id": "49591807-25b2-4a31-a430-415e86dd22ab",
              "name": "Name",
              "value": "={{ $('Edit Req Fields for Form').first().json.Name }}",
              "type": "string"
            },
            {
              "id": "3d23a6a7-0c26-4bcd-ac56-6947a68404d3",
              "name": "Email",
              "value": "={{ $('Edit Req Fields for Form').first().json.Email }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3664,
        -1792
      ],
      "id": "aab94428-78b9-48b6-997a-69f3657187be",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n\n  // Read AI output safely\n  let raw =\n    item.json.content?.parts?.[0]?.text ||\n    item.json.message?.content ||\n    item.json.message ||\n    \"\";\n\n  // Normalize line breaks\n  raw = raw.replace(/\\\\n/g, \"\\n\");\n\n  // Extract helper\n  const extract = (key) => {\n    const regex = new RegExp(`${key}:\\\\s*(.+)`, \"i\");\n    const match = raw.match(regex);\n    return match ? match[1].trim() : \"\";\n  };\n\n  // Assign clean output\n  item.json = {\n    name: extract(\"Name\"),\n    email: extract(\"Email\"),\n    lead_stage: extract(\"Lead Stage\"),\n    reason: extract(\"Reason\"),\n    coach_notes: extract(\"Coach Notes\")\n  };\n\n}\n\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4400,
        -1008
      ],
      "id": "ff9c1244-1bcf-4eac-add8-a33451a76104",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "82dfc6ac-0af4-44e0-99ad-f556be6f2a87",
              "name": "name",
              "value": "={{ $json.name }}",
              "type": "string"
            },
            {
              "id": "7433e411-0b73-4486-a4c8-ec774a475bdf",
              "name": "email",
              "value": "={{ $json.email }}",
              "type": "string"
            },
            {
              "id": "f6c13b9c-f986-455f-b06f-542588e68756",
              "name": "lead_stage",
              "value": "={{ $json.lead_stage }}",
              "type": "string"
            },
            {
              "id": "2b90c612-331c-43e6-ab4a-68405fbb634a",
              "name": "reason",
              "value": "={{ $json.reason }}",
              "type": "string"
            },
            {
              "id": "5a8f2d38-19a1-45c6-83d4-ef3defa981ce",
              "name": "coach_notes",
              "value": "={{ $json.coach_notes }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4128,
        -1008
      ],
      "id": "989c6a13-1672-48e5-9539-43c4671ec5db",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Website Forms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $json.Email }}",
            "Date": "={{ new Date().toLocaleDateString('en-IN', { timeZone: 'Asia/Kolkata' }) }}",
            "Name": "={{ $json.Name }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Problem Summary",
              "displayName": "Problem Summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Need type",
              "displayName": "Need type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Intent Score",
              "displayName": "Intent Score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Lead Stage",
              "displayName": "Lead Stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reason",
              "displayName": "Reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Pain Intensity",
              "displayName": "Pain Intensity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Coach notes",
              "displayName": "Coach notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2816,
        -1888
      ],
      "id": "db35952e-fda0-471c-900b-538199f7d874",
      "name": "Update Form Sheet 1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Websiteforms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $('Switch').item.json.name }}",
            "Email": "={{ $('Switch').item.json.email }}",
            "Need type": "={{ $('Edit Fields').first().json.need_type }}",
            "Lead Stage": "={{ $('Code in JavaScript1').first().json.lead_stage }}",
            "Reason": "={{ $('Code in JavaScript1').first().json.reason }}",
            "Coach notes": "={{ $('Edit Fields1').item.json.coach_notes }}",
            "Date": "={{ $now }}",
            "Problem Summary": "={{ $('Edit Fields').first().json.problem_summary }}",
            "Intent Score": "={{ $('Edit Fields').first().json.intent_score }}",
            "Pain Intensity": "={{ $('Edit Fields').first().json.pain_intensity }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Problem Summary",
              "displayName": "Problem Summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Need type",
              "displayName": "Need type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Intent Score",
              "displayName": "Intent Score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Lead Stage",
              "displayName": "Lead Stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Reason",
              "displayName": "Reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Pain Intensity",
              "displayName": "Pain Intensity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Coach notes",
              "displayName": "Coach notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2656,
        -1552
      ],
      "id": "ebeb7404-ca47-4d84-933d-dbd3a5545127",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Hot",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "0e3762bf-b17e-495d-a9f7-61904bc8b577"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Hot"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8cd1127e-6ed2-4800-8bc8-35a2687fba11",
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Warm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Warm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d378bd21-f613-4a55-ad6e-b9a061adc0e8",
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Cold",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cold"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a895fc85-1600-4a1b-94fa-0baaa00ebbbe",
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Unqualified",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Unqualified"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -3856,
        -1040
      ],
      "id": "2a3ed4cb-a4b1-4ae2-9c8a-1d86aff7233c",
      "name": "Switch"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.email }}",
        "subject": "New Lead",
        "message": "=<!doctype html>\n<html>\n  <body style=\"margin:0; padding:0; background:#f6f7fb; font-family:Arial, sans-serif;\">\n\n    <div style=\"max-width:600px; margin:30px auto; padding:20px;\">\n\n      <!-- Colorful Box -->\n      <div style=\"background:#ffffff; border-left:6px solid #ff6d5a; padding:22px 26px; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.08);\">\n\n        <p style=\"font-size:15px; color:#111; margin:0 0 14px 0;\">\n          Hi {{ $json.name }},\n        </p>\n\n        <p style=\"font-size:15px; color:#333; line-height:1.6; margin:0 0 14px 0;\">\n          I read your note about <strong>{{ $('Code in JavaScript').first().json.problem_summary }}</strong> and I am confident we can make progress quickly.\n        </p>\n\n        <p style=\"font-size:15px; color:#333; line-height:1.6; margin:0 0 22px 0;\">\n          Here is my calendar link so we can talk and create your action plan.\n        </p>\n\n        <div style=\"text-align:left; margin-bottom:26px;\">\n          <a href=\"{{calendar_link}}\"\n            style=\"background:#ff6d5a; padding:12px 22px; color:#ffffff; text-decoration:none; \n                   font-size:15px; font-weight:bold; border-radius:6px; display:inline-block;\">\n            Book Call\n          </a>\n        </div>\n\n        <p style=\"font-size:14px; color:#555; margin:0 0 18px 0; line-height:1.5;\">\n          If the time slots do not fit, reply and I will adjust the schedule.\n        </p>\n\n        <p style=\"font-size:12px; color:#999; margin-top:28px;\">\n          Lumoscale Automations\n        </p>\n\n      </div>\n\n    </div>\n\n  </body>\n</html>\n",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3344,
        -1552
      ],
      "id": "499f7422-c856-49bc-8f57-9d60a5f30959",
      "name": "Hot Lead",
      "webhookId": "60502eb8-e3ed-409e-a9b8-7235cfc5885a",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09PV3DSRJQ",
          "mode": "list",
          "cachedResultName": "n8n"
        },
        "messageType": "block",
        "blocksUi": "={\n  \"blocks\": [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": \"ðŸ”¥ Hot Lead Alert\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*Name*: {{ $json.name }}\\n*Email*: {{ $json.email }}\\n*Problem*: {{ $('Edit Fields').item.json.problem_summary }}\\n*Need Type*: {{ $('Edit Fields').item.json.need_type }}\\n*Intensity*: {{ $('Edit Fields').item.json.pain_intensity }}\\n*Reason*: {{ $json.reason }}\\n*Coach Notes*: {{ $json.coach_notes }}\"\n      }\n    },\n    {\n      \"type\": \"divider\"\n    }\n  ]\n}\n",
        "text": "New",
        "otherOptions": {
          "includeLinkToWorkflow": false,
          "unfurl_links": false,
          "unfurl_media": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -3344,
        -1376
      ],
      "id": "f21eee62-8c32-4041-bc17-6ba982b2d523",
      "name": "Hot Slack Message",
      "webhookId": "82b90f26-e9d7-4045-a8a8-cc5473612c04",
      "credentials": {
        "slackOAuth2Api": {
          "id": "Rb7HyhAgq0iIU3TT",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {
          "includeSpamTrash": false,
          "q": "(\"need help\" OR \"interested\" OR \"looking for\" OR \"want to discuss\" OR \"call\" OR \"project\" OR \"collaboration\" OR \"requirement\" OR \"support\") -category:{promotions social updates forums} -in:chats",
          "readStatus": "unread"
        }
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        -5072,
        256
      ],
      "id": "f2e88029-f561-48ff-a283-0048485961da",
      "name": "Check Email For Every Min",
      "credentials": {
        "gmailOAuth2": {
          "id": "UbWO1LFfZ6s8MzMA",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cea558f7-054e-4683-b3c7-1f6c9ee826b1",
              "name": "name",
              "value": "={{ $json.name }}",
              "type": "string"
            },
            {
              "id": "d671d03e-ff69-4da0-92d7-2e9efb6c396f",
              "name": "email",
              "value": "={{ $json.email }}",
              "type": "string"
            },
            {
              "id": "3c00aba2-34a7-4551-8d5c-66be91ca170d",
              "name": "problem_summary",
              "value": "={{ $json.problem_summary }}",
              "type": "string"
            },
            {
              "id": "4b5770ed-4489-4ca9-aeea-a9d129c17b29",
              "name": "need_type",
              "value": "={{ $json.need_type }}",
              "type": "string"
            },
            {
              "id": "6b960e1a-f477-4a82-a1e7-9856d64d79a2",
              "name": "readiness_level",
              "value": "={{ $json.readiness_level }}",
              "type": "string"
            },
            {
              "id": "b0e54638-86b7-48a7-b8fb-3a6cd2c4043f",
              "name": "lead_score",
              "value": "={{ $json.lead_score }}",
              "type": "number"
            },
            {
              "id": "1586508d-c5a8-4499-9ccc-7941d0d0d0a8",
              "name": "coach_notes",
              "value": "={{ $json.coach_notes }}",
              "type": "string"
            },
            {
              "id": "94b07439-e1cb-4f17-bb13-de0182786ed4",
              "name": "snippet",
              "value": "={{ $('Check Email For Every Min').first().json.snippet }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4080,
        256
      ],
      "id": "025d7c5f-3627-472c-b223-dc82a75b6bf2",
      "name": "Edit Req Fields for Email"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1573018970,
          "mode": "list",
          "cachedResultName": "Gmail",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1573018970"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "From": "={{ $('Edit Required Fields for next step').item.json.From }}",
            "Subject": "={{ $('Edit Required Fields for next step').item.json.Subject }}",
            "Date": "={{ new Date().toLocaleDateString('en-IN', { timeZone: 'Asia/Kolkata' }) }}",
            "Body": "={{ $('Edit Required Fields for next step').item.json.snippet }}"
          },
          "matchingColumns": [
            "From"
          ],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "From",
              "displayName": "From",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Subject",
              "displayName": "Subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Body",
              "displayName": "Body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3296,
        160
      ],
      "id": "4f85a518-546d-45a4-a888-3df6ef7c336a",
      "name": "Update Gmail Sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const output = [];\n\nfor (const item of $input.all()) {\n  try {\n    // Read AI output safely\n    let rawText =\n      item.json.content?.parts?.[0]?.text ||\n      item.json.message?.content ||\n      item.json.message ||\n      \"\";\n\n    // Normalize line breaks\n    rawText = rawText.replace(/\\\\n/g, \"\\n\");\n\n    // Remove markdown if any (```json ... ```)\n    const cleanText = rawText.replace(/```json|```/g, \"\").trim();\n\n    // Parse JSON\n    const parsed = JSON.parse(cleanText);\n\n    // Push structured clean output\n    output.push({\n      json: {\n        name: parsed.name || \"\",\n        email: parsed.email || \"\",\n        problem_summary: parsed.problem_summary || \"\",\n        need_type: parsed.need_type || \"\",\n        readiness_level: parsed.readiness_level || \"\",\n        lead_score: Number(parsed.lead_score) || 0,\n        coach_notes: parsed.coach_notes || \"\"\n      }\n    });\n\n  } catch (err) {\n    // Fallback in case parsing fails\n    output.push({\n      json: {\n        name: \"\",\n        email: \"\",\n        problem_summary: \"Parse error\",\n        need_type: \"other\",\n        readiness_level: \"None\",\n        lead_score: 1,\n        coach_notes: \"Manual review required\"\n      }\n    });\n  }\n}\n\nreturn output;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4288,
        256
      ],
      "id": "880fcfa9-9349-4690-84dc-629c6736c969",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash-lite-preview-09-2025",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash-lite-preview-09-2025"
        },
        "messages": {
          "values": [
            {
              "content": "=# Gmail Lead Qualification Prompt\n\nYou are an expert Lead Qualification Assistant for a Coaching Automation Agency.\n\nYou will receive one email pulled from Gmail.  \nYour job is to decide whether the message is:\n- a real lead,\n- a system or calendar message,\n- a promotion or newsletter,\n- or spam.\n\nIf it is a system message, calendar invite, promotion, or automated email, treat it as NOT A LEAD and score it 1.\n\nIf it is a real message from a person asking about help, services, coaching, or business growth, treat it as a lead and qualify it.\n\n---\n\n## EMAIL DATA\n\nFrom: {{ $json.From }}  \nTo: {{ $json.To }}  \nSubject: {{ $json.Subject }}  \nSnippet: {{ $json.snippet }}  \nReceived_at: {{ $json.Received_at }}\n\n---\n\n## YOUR TASK\n\n### Step 1: Understand the Intent\n\nRead the subject and snippet and decide what the email is actually about.\n\nExamples:\n- \"Meeting invite\" = system message\n- \"Reset password\" = system message\n- \"Limited offer\" = promotion\n- \"Need help with leads\" = real lead\n\nIf there is no clear problem or request for help, treat it as not a lead.\n\n---\n\n### Step 2: Identify the Area\n\nChoose one category that best fits:\n\n- `mindset` if it is about confidence, burnout, stress\n- `business` if it is about growth, systems, operations\n- `marketing` if it is about leads, ads, traffic\n- `relationship` if it is about people, team, communication\n- `health` if it is about body, mental health, wellness\n- `career` if it is about job, role, direction\n- `other` if it does not match any above\n\n---\n\n### Step 3: Determine Readiness Level\n\nDecide how willing the person sounds:\n\n- `Exploring` if they are just asking or curious\n- `Interested` if they describe a problem and want help\n- `Ready to Invest` if they mention urgency, money, timeline, or decision making\n\n---\n\n### Step 4: Score the Lead (1â€“5)\n\nUse this scale:\n\n- 1 = calendar invite, newsletter, system message, spam\n- 2 = human email but vague or casual\n- 3 = real problem, low urgency\n- 4 = clear problem with intent\n- 5 = urgent and serious buyer\n\n---\n\n### Coach Notes Instructions\n\nWrite one short line telling the coach what to do next.\n\nExamples:\n- \"Ignore this email, it is only a calendar invitation\"\n- \"Send intro email and offer discovery call\"\n- \"Follow up fast and book strategy session\"\n\n---\n\n## OUTPUT FORMAT (STRICT JSON)\n\nReturn exactly this JSON. Do not add explanation. Do not add markdown.\n\n```json\n{\n  \"name\": \"{{ $json[\"From\"].match(/^([^<]+)/) ? $json[\"From\"].match(/^([^<]+)/)[1].trim() : $json[\"From\"].trim() }}\",\n  \"email\": \"{{ $json[\"From\"].match(/<([^>]+)>/) ? $json[\"From\"].match(/<([^>]+)>/)[1].trim() : $json[\"From\"].trim() }}\",\n  \"problem_summary\": \"\",\n  \"need_type\": \"\",\n  \"readiness_level\": \"\",\n  \"lead_score\": \"\",\n  \"coach_notes\": \"\"\n}\n```\n\n---\n\n## RULES\n\n- Output JSON only  \n- Never repeat the email  \n- Never explain reasoning  \n- Always return valid JSON  \n- Be decisive  \n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4640,
        256
      ],
      "id": "e4a1aa6b-e8eb-441e-9f53-73ed6b84f08a",
      "name": "Message a model2",
      "credentials": {
        "googlePalmApi": {
          "id": "Gq3qNdXZmlzVb7Jg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "01befe42-f604-40ce-afde-99f5347d4494",
              "name": "From",
              "value": "={{ $json.From }}",
              "type": "string"
            },
            {
              "id": "f1843917-44c7-49a5-b925-cb2e6f3ba2c4",
              "name": "To",
              "value": "={{ $json.To }}",
              "type": "string"
            },
            {
              "id": "f7dd0511-74b3-462d-8fc8-a93e9f72c6a6",
              "name": "Subject",
              "value": "={{ $json.Subject }}",
              "type": "string"
            },
            {
              "id": "2290a93c-dad1-4808-aabe-ce67f2ab3f7a",
              "name": "snippet",
              "value": "={{ $json.snippet }}",
              "type": "string"
            },
            {
              "id": "f3a32e46-7e1c-4bca-89cd-bb15317d728c",
              "name": "Received_at",
              "value": "={{ new Date($now.toLocaleString(\"en-US\", { timeZone: \"Asia/Calcutta\" })).toLocaleDateString(\"en-US\") }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4848,
        256
      ],
      "id": "47d18b93-8df1-4ccf-96b1-67af1e99e689",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "jsCode": "const output = [];\n\nfor (const item of $input.all()) {\n  try {\n    // Step 1: Read AI message safely\n    let raw =\n      item.json.message?.content ||\n      item.json.message ||\n      item.json.content?.parts?.[0]?.text ||\n      \"\";\n\n    // Step 2: Normalize and clean\n    let clean = raw\n      .replace(/\\\\n/g, \"\\n\")\n      .replace(/```json|```/g, \"\")\n      .trim();\n\n    // Step 3: Extract JSON block only\n    const match = clean.match(/{[\\s\\S]*}/);\n    if (!match) throw new Error(\"No JSON object found\");\n\n    const jsonString = match[0];\n\n    // Step 4: Parse JSON\n    const data = JSON.parse(jsonString);\n\n    // Step 5: Push clean structured output\n    output.push({\n      json: {\n        name: data.name || \"\",\n        email: data.email || \"\",\n        lead_stage: data.lead_stage || \"\",\n        reason: data.reason || \"\",\n        coach_notes: data.coach_notes || \"\"\n      }\n    });\n\n  } catch (err) {\n    // Fallback on failure\n    output.push({\n      json: {\n        name: \"\",\n        email: \"\",\n        lead_stage: \"Unqualified\",\n        reason: \"Parsing failed or invalid AI output\",\n        coach_notes: \"Manual review required\"\n      }\n    });\n  }\n}\n\nreturn output;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4528,
        944
      ],
      "id": "3a172672-e75e-4bdb-9cdb-e43f684ac674",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Lead Qualification System",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1573018970,
          "mode": "list",
          "cachedResultName": "Gmail",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1573018970"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Email",
              "lookupValue": "={{ $json.email }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3840,
        144
      ],
      "id": "a7d6b974-9672-4fd8-a3f7-dbc175181a67",
      "name": "Duplicates in Gmail sheet1",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "323ad272-08e7-462f-9774-efe6946dfba0",
              "leftValue": "={{ $json.email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3568,
        288
      ],
      "id": "a7198856-284e-41fa-85ba-04ec7f965390",
      "name": "If duplicates Found vs Not Found - Instagram1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "589e356b-1d64-416f-9394-e3843da7aec2",
              "name": "name",
              "value": "={{ $json.name }}",
              "type": "string"
            },
            {
              "id": "14424bad-6058-443e-a031-324dc29c44cb",
              "name": "email",
              "value": "={{ $json.email }}",
              "type": "string"
            },
            {
              "id": "ebba7beb-6aa7-4ada-8703-8ca5785583d7",
              "name": "lead_stage",
              "value": "={{ $json.lead_stage }}",
              "type": "string"
            },
            {
              "id": "d6a0ebe5-6223-4beb-b036-89862a968bde",
              "name": "coach_notes",
              "value": "={{ $json.coach_notes }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4304,
        944
      ],
      "id": "384fc65f-4d31-4377-9ad1-5487d4097e2d",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Hot",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "0e3762bf-b17e-495d-a9f7-61904bc8b577"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Hot"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dd643b98-b4c3-4e5f-8638-3828df6b03a0",
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Warm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Warm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4a915986-2163-43c2-aa5f-cad1239b6929",
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Cold",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cold"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a895fc85-1600-4a1b-94fa-0baaa00ebbbe",
                    "leftValue": "={{ $json.lead_stage }}",
                    "rightValue": "Unqualified",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Unqualified"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -4096,
        912
      ],
      "id": "4d741280-ce9b-4648-a5a6-03e01ba1cf01",
      "name": "Switch1"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.email }}",
        "subject": "New Lead",
        "message": "=<html>\n  <body style=\"font-family: 'Segoe UI', Arial, sans-serif; background-color: #f8f9fb; padding: 20px;\">\n    <table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);\">\n      <tr>\n        <td style=\"padding: 30px; text-align: center;\">\n          <h2 style=\"color: #e63946;\">ðŸ”¥ Letâ€™s Chat â€” I Think I Can Help You!</h2>\n          <p style=\"color: #444; font-size: 16px; line-height: 1.6;\">\n            Hey {{ $json.name }},  \n            I just went through your note about <strong>{{ $json.problem_summary }}</strong> â€” and I can already see a few quick wins that can turn things around fast.\n          </p>\n          <p style=\"color: #444; font-size: 16px;\">\n            Letâ€™s connect for a short strategy call to dive in and map out a solution tailored for your business.\n          </p>\n\n          <a href=\"[calendar_link]\" \n             style=\"display:inline-block; background-color:#e63946; color:#fff; padding:12px 24px; \n                    border-radius:8px; text-decoration:none; font-weight:bold; margin-top:15px;\">\n            ðŸ“… Book Your Strategy Call\n          </a>\n\n          <p style=\"margin-top:25px; color:#777; font-size:14px;\">\n            Canâ€™t find a slot that fits? Just reply to this email and Iâ€™ll make one work for you.\n          </p>\n\n          <hr style=\"margin:30px 0; border:none; border-top:1px solid #eee;\">\n          <p style=\"font-size:13px; color:#aaa;\">\n            Sent by Lumoscale â€” helping coaches automate lead generation & onboarding.<br>\n            [coach_name]\n          </p>\n        </td>\n      </tr>\n    </table>\n  </body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3648,
        496
      ],
      "id": "ce65e0d1-16a1-43c0-8221-d648336d0b92",
      "name": "Send a message2",
      "webhookId": "60502eb8-e3ed-409e-a9b8-7235cfc5885a",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Coaches",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1573018970,
          "mode": "list",
          "cachedResultName": "Gmail",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=1573018970"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $('Edit Fields3').item.json.email }}",
            "Date": "={{ $now }}",
            "Subject": "={{ $('Edit Fields2').item.json.Subject }}",
            "Body": "={{ $json.snippet }}",
            "problem_summary": "={{ $json.problem_summary }}",
            "need_type": "={{ $json.need_type }}",
            "lead_score": "={{ $json.lead_score }}",
            "reason": "={{ $json.reason }}",
            "coach_notes": "={{ $json.coach_notes }}",
            "lead_stage": "={{ $json.lead_stage }}",
            "Name": "={{ $('Edit Fields3').item.json.name }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Subject",
              "displayName": "Subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Body",
              "displayName": "Body",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "problem_summary",
              "displayName": "problem_summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "need_type",
              "displayName": "need_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "lead_score",
              "displayName": "lead_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "lead_stage",
              "displayName": "lead_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reason",
              "displayName": "reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "coach_notes",
              "displayName": "coach_notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2960,
        720
      ],
      "id": "3cf343c8-1b67-431d-ac1a-9787a099fe10",
      "name": "Append row in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09PV3DSRJQ",
          "mode": "list",
          "cachedResultName": "n8n"
        },
        "messageType": "block",
        "blocksUi": "={\n  \"blocks\": [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": \"ðŸ”¥ HOT LEAD ALERT!\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*Name:* {{$json.name}}\\n*Email:* {{$json.email}}\\n*Problem:* {{$json.problem_summary}}\\n*Need Type:* {{$json.need_type}}\\n*Lead Score:* *{{$json.lead_score}}/10*\\n*Stage:* {{$json.lead_stage}}\"\n      },\n      \"accessory\": {\n        \"type\": \"image\",\n        \"image_url\": \"https://cdn-icons-png.flaticon.com/512/906/906343.png\",\n        \"alt_text\": \"Hot Lead\"\n      }\n    },\n    {\n      \"type\": \"divider\"\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"ðŸ§  *Reason:*\\n>{{$json.reason}}\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"ðŸŽ¯ *Coach Notes:*\\n>{{$json.coach_notes}}\"\n      }\n    },\n    {\n      \"type\": \"divider\"\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"ðŸš€ *Action Tip:* Reach out or DM within *30 minutes* to secure this lead!\"\n      }\n    },\n    {\n      \"type\": \"context\",\n      \"elements\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"âš¡ _Lead detected by Lumoscale AI Qualification System_\"\n        }\n      ]\n    },\n    {\n      \"type\": \"divider\"\n    },\n    {\n      \"type\": \"actions\",\n      \"elements\": [\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"âœ… Contacted\"\n          },\n          \"style\": \"primary\",\n          \"value\": \"contacted\"\n        },\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"ðŸ•’ Follow-Up Later\"\n          },\n          \"value\": \"follow_up\"\n        },\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"ðŸ“ Add Notes\"\n          },\n          \"style\": \"danger\",\n          \"url\": \"https://forms.gle/your-feedback-form-link\"\n        }\n      ]\n    }\n  ]\n}\n",
        "text": "New",
        "otherOptions": {
          "includeLinkToWorkflow": false,
          "unfurl_links": false,
          "unfurl_media": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -3632,
        656
      ],
      "id": "47017567-eb7c-4835-bb22-55d93bc17c31",
      "name": "Send a message3",
      "webhookId": "82b90f26-e9d7-4045-a8a8-cc5473612c04",
      "credentials": {
        "slackOAuth2Api": {
          "id": "Rb7HyhAgq0iIU3TT",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash-lite",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash-lite"
        },
        "messages": {
          "values": [
            {
              "content": "=# Lead Classification AI Prompt (Final High Accuracy Version)\n\n## ROLE\nYou are a Lead Qualification AI for a coaching or high ticket service business.\n\nYour goal is simple:  \nDecide if the lead is **Hot, Warm, Cold, or Unqualified**.\n\nYou think like a coach and like a closer.\nYou judge buying intent, urgency, seriousness, and readiness.\n\n---\n\n## INPUT YOU WILL RECEIVE\n\nconversation_log  \n{{ $('Code in JavaScript5').item.json.conversation_log }}\n\nnew_message  \n{{ $('Instagram DMs').first().json.body.entry[0].messaging[0].message.text }}\n\nprevious_ai_reply  \n{{ $('Code in JavaScript4').item.json.reply }}\n\nprevious_ai_intent  \n{{ $('Code in JavaScript4').item.json.intent }}\n\nprevious_ai_next_action  \n{{ $('Code in JavaScript4').item.json.next_action }}\n\nproblem_summary  \n{{ $('Code in JavaScript4').item.json.problem_summary }}\n\nneed_type  \n{{ $('Code in JavaScript4').item.json.need_type }}\n\nreadiness_level  \n{{ $('Code in JavaScript4').item.json.readiness_level }}\n\nlead_score  \n{{ $('Code in JavaScript4').item.json.lead_score }}\n\ncoach_notes  \n{{ $('Code in JavaScript4').item.json.coach_notes }}\n\nsummary_text  \n{{ $('Code in JavaScript4').item.json.summary_text }}\n\n---\n\n## YOUR TASK\n\nRead everything.\nLook at message pattern over time.\nIgnore surface words.\nDecide the single most accurate lead stage.\n\n---\n\n## HOW TO THINK\n\nEvaluate in this order:\n\n1) Buying intent  \nAre they asking for results, investment, or next steps?\n\n2) Urgency  \nDo they talk about time, pressure, stress, or need?\n\n3) Ownership  \nDo they take responsibility or blame others?\n\n4) Pattern shift  \nHas the conversation moved closer to action?\n\n5) Emotional weight  \nDo they sound serious or casual?\n\n---\n\n## CLASSIFICATION RULES\n\n### HOT LEAD\nChoose Hot when most of these are true:\n\nStrong buying signals  \nUrgent or emotionally heavy language  \nAsking about pricing, calls, or starting  \nClear desire for change  \nOwnership language\n\nExamples:\n\"I want to start now\"\n\"Are you taking clients?\"\n\"Can we talk about this\"\n\"I need help right now\"\n\"How much is it\"\n\n---\n\n### WARM LEAD\nChoose Warm when:\n\nThey are interested but not urgent  \nThey ask questions  \nThey share problems casually  \nThey are not committing yet\n\nExamples:\n\"I have been thinking about this\"\n\"I want to learn more\"\n\"I might need help\"\n\"Not sure yet but curious\"\n\n---\n\n### COLD LEAD\nChoose Cold when:\n\nShort replies  \nNo clear intent  \nJust greeting or browsing  \nNo emotional pressure\n\nExamples:\n\"Hi\"\n\"Hello\"\n\"Okay\"\n\"Nice\"\n\n---\n\n### UNQUALIFIED\nChoose Unqualified when:\n\nSpam  \nRandom messages  \nIrrelevant content  \nSystem messages\n\nExamples:\n\"Follow for follow\"\n\"Buy crypto\"\n\"Click link\"\n\"Free giveaway\"\n\n---\n\n## OUTPUT FORMAT (STRICT JSON ONLY)\n\nReturn JSON only.  \n\n```json\n{\n  \"lead_stage\": \"Hot or Warm or Cold or Unqualified\",\n  \"reason\": \"One or two short lines explaining why\",\n  \"confidence\": \"High or Medium or Low\"\n}\n```\n\n---\n\n## RULES\n\n- Always pick one stage  \n- Never output outside JSON  \n- Be strict and objective  \n- No politeness  \n- No explanation paragraphs  \n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        1232,
        -1152
      ],
      "id": "306f22f0-a2be-4a59-b3c3-0951e7a2f246",
      "name": "Message a model",
      "credentials": {
        "googlePalmApi": {
          "id": "Gq3qNdXZmlzVb7Jg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash-lite",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash-lite"
        },
        "messages": {
          "values": [
            {
              "content": "=# Lead Signal Extraction Prompt\n\n## ROLE\nYou are a Lead Qualification AI for a coaching or service business.  \nYour job is to extract psychological and buying signals from lead form submissions.\n\nYou must:\n- Detect urgency, intent, and readiness\n- Measure emotional state\n- Evaluate clarity and seriousness\n- Recommend next steps for the coach\n- Never classify the lead as hot, warm, or cold\n- Never explain your reasoning\n- Output decision signals and one clear action paragraph only\n\n---\n\n## INPUT PROVIDED\n\nYou will receive:\n\n- Name: {{ $json.Name }}\n- Email: {{ $json.Email }}\n- Phone: {{ $json.Email }}\n- Business type: {{ $json['Business type'] }}\n- Monthly revenue range: {{ $json['Monthly revenue range'] }}\n- Biggest challenge: {{ $json['What\\'s your biggest challenge right now?'] }}\n- Urgency timeline: {{ $json['How soon do you want to solve this'] }}\n- 90 day goal: {{ $json['What is your biggest goal in the next 90 days'] }}\n- Timestamp: {{ $now }}\n\n---\n\n## YOUR TASK  \nAnalyze the form and extract structured signals for automation and sales.\n\n---\n\n## SIGNALS AND EXAMPLES\n\n### 1) Core Pain  \nIdentify the real problem behind the words.\n\nExamples:\n- \"Not getting enough qualified leads\"\n- \"Struggling to convert leads into clients\"\n- \"No predictable income\"\n- \"Overwhelmed managing everything alone\"\n\nOutput one short sentence.\n\n---\n\n### 2) Primary Need Type  \nChoose one category that matches the problem.\n\nOptions and examples:\n- marketing â†’ traffic, leads, visibility\n- sales â†’ converting, closing, objections\n- systems â†’ processes, operations, backend\n- automation â†’ tools, workflows, AI\n- mindset â†’ fear, confidence, burnout\n- finance â†’ pricing, cash flow\n- productivity â†’ focus, performance\n- time management â†’ overwork, chaos\n- career â†’ direction and role confusion\n- business â†’ strategy, growth\n- other â†’ anything that does not fit\n\n---\n\n### 3) Emotional Tone  \nChoose the emotional feeling from the wording.\n\nExamples:\n- hopeful â†’ \"I want to grow\"\n- confused â†’ \"I don't know what to do\"\n- stressed â†’ \"I am tired of trying\"\n- overwhelmed â†’ \"Too much is happening\"\n- positive â†’ \"Things are improving\"\n- negative â†’ \"Nothing works\"\n- neutral â†’ emotionally flat\n\nChoose one.\n\n---\n\n### 4) Pain Intensity (1â€“5)  \nScore emotional and business pressure.\n\nExamples:\n- 1 â†’ \"Just curious\"\n- 3 â†’ \"I want improvement\"\n- 5 â†’ \"I need this solved now\"\n\n---\n\n### 5) Commitment Words Count  \nCount buying language used.\n\nExamples:\n- \"I am ready to invest\" = 2  \n- \"I want to start and build\" = 2  \n- No commitment words = 0  \n\nWords:\nready, start, invest, hire, schedule, pay, launch, build, scale, close\n\n---\n\n### 6) Urgency Flag  \nTrue when urgency appears.\n\nExample true:\n- \"Immediate\"\n- \"Now\"\n- \"This week\"\n\nExample false:\n- \"Whenever\"\n- \"Someday\"\n- \"In future\"\n\n---\n\n### 7) Action Words Count  \nCount past effort.\n\nExamples:\n- \"I tried Facebook ads\" = 1  \n- \"I tested two offers and hired a freelancer\" = 3  \n\nWords:\ntried, tested, launched, hired, executed, implemented, failed, learned, applied\n\n---\n\n### 8) Victim Mindset  \nTrue if blame or helpless language appears.\n\nExample true:\n- \"Market is bad\"\n- \"Clients never respond\"\n- \"Nothing works for me\"\n\nExample false:\n- \"I need help fixing this\"\n- \"I want to improve\"\n\n---\n\n### 9) Revenue Strength (1â€“5)  \nBased on income stability.\n\nExamples:\n- 1 â†’ no income mentioned\n- 3 â†’ small or unstable income\n- 5 â†’ strong revenue\n\n---\n\n### 10) Intent Score (1â€“5)  \nHow soon they want action.\n\nExamples:\n- 1 â†’ browsing\n- 3 â†’ problem aware\n- 5 â†’ buyer intent\n\n---\n\n### 11) Clarity Score (1â€“5)  \nHow well problem is stated.\n\nExamples:\n- 1 â†’ \"I need help\"\n- 3 â†’ \"Not getting leads\"\n- 5 â†’ \"Need 5 clients in 30 days\"\n\n---\n\n### 12) Goal Quality (1â€“5)  \nHow measurable the goal is.\n\nExamples:\n- 1 â†’ \"I want success\"\n- 3 â†’ \"I want more income\"\n- 5 â†’ \"Close 5 deals in 90 days\"\n\n---\n\n### 13) Notes (Instruction Paragraph)\n\nWrite one paragraph telling the coach exactly what to do and what the client should prepare.\n\nExamples:\n\nFor urgent clients  \nAsk the client to prepare their current lead sources, conversion numbers, and pricing so the session can focus on identifying leaks and building an action plan.\n\nFor early stage clients  \nSuggest sending educational resources and inviting them to a strategy call to clarify goals before discussing offers.\n\n---\n\n## OUTPUT FORMAT (STRICT JSON)\n\nReturn JSON only:\n\n{\n  \"CorePain\": \"\",\n  \"NeedType\": \"\",\n  \"Emotion\": \"\",\n  \"PainIntensity\": 0,\n  \"CommittedWordsCount\": 0,\n  \"UrgencyFlag\": false,\n  \"ActionWordsCount\": 0,\n  \"VictimLanguage\": false,\n  \"RevenueScore\": 0,\n  \"IntentScore\": 0,\n  \"ClarityScore\": 0,\n  \"GoalQualityScore\": 0,\n  \"Notes\": \"\"\n}\n\n---\n\n## RULES\n\n- No explanations\n- JSON only\n- No classification\n- One paragraph in Notes\n- Be decisive\n"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4352,
        -1792
      ],
      "id": "1a13739e-a685-4aa9-a782-a9119270e49e",
      "name": "Message a model4",
      "credentials": {
        "googlePalmApi": {
          "id": "Gq3qNdXZmlzVb7Jg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash-lite",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash-lite"
        },
        "messages": {
          "values": [
            {
              "content": "=# Lead Stage Classification Prompt\n\n## ROLE\nYou are a Lead Qualification AI Assistant for a coaching business.  \nYour job is to classify one lead as Hot, Warm, Cold, or Unqualified.\n\nYou think like an experienced coach and judge urgency, emotional pressure, ownership, seriousness, intent, and readiness to change.\n\n---\n\n## INPUT YOU WILL RECEIVE\n\nYou will receive these fields from Edit Fields:\n\n- Name: {{ $('Edit Fields').item.json.Name }}\n- Email: {{ $('Edit Fields').item.json.Email }}\n- Core Pain: {{ $('Edit Fields').item.json.core_pain }}\n- Need Type: {{ $('Edit Fields').item.json.need_type }}\n- Emotion: {{ $('Edit Fields').item.json.emotion }}\n- Pain Intensity: {{ $('Edit Fields').item.json.pain_intensity }}\n- Commitment Count: {{ $('Edit Fields').item.json.committed_words }}\n- Urgency Flag: {{ $('Edit Fields').item.json.urgency_flag }}\n- Action Count: {{ $('Edit Fields').item.json.action_words }}\n- Victim Language: {{ $('Edit Fields').item.json.victim_language }}\n- Revenue Score: {{ $('Edit Fields').item.json.revenue_score }}\n- Intent Score: {{ $('Edit Fields').item.json.intent_score }}\n- Clarity Score: {{ $('Edit Fields').item.json.clarity_score }}\n- Goal Quality Score: {{ $('Edit Fields').item.json.goal_quality_score }}\n- Notes from previous AI: {{ $('Edit Fields').item.json.coach_notes }}\n\n---\n\n## HOW TO DECIDE\n\nA lead is Hot when urgency, ownership, and intent appear together.  \nHigh pain or visible urgency must exist.  \nIntent Score should be 4 or 5 and commitment language must be present.  \nThey should sound solution focused and decisive.\n\nA lead is Warm when the problem is real but urgency is weak.  \nThey sound interested but not emotionally compelled.  \nIntent Score is typically 3 to 4 with no urgency.\n\nA lead is Cold when urgency is missing and emotional involvement is low.  \nThey show little commitment or action.  \nIntent Score is usually 1 or 2 or the tone sounds passive.\n\nA lead is Unqualified when coaching is not a fit.  \nRevenue Score of 1 with no clarity indicates Unqualified.  \nIf the problem is random, irrelevant, or spam like, mark Unqualified.\n\n---\n\n## EXAMPLES\n\nHot example:  \n\"I need this solved now and I am ready to act.\"\n\nWarm example:  \n\"I know I have this issue and I am exploring options.\"\n\nCold example:  \n\"I am just checking.\"\n\nUnqualified example:  \n\"Test message\" or meaningless submission.\n\n---\n\n## OUTPUT FORMAT (STRICT)\n\nReturn exactly:\n\nName: {{ $('Edit Fields').item.json.Name }}  \nEmail: {{ $('Edit Fields').item.json.Email }}  \nLead Stage: Hot or Warm or Cold or Unqualified  \nReason: Two or three short lines explaining emotional and logical decision  \nCoach Notes: One action step for the coach\n\n---\n\n## RULES\n\n- Do not repeat the input  \n- No extra commentary  \n- Always return one stage  \n- Be decisive  \n\n"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4752,
        -1008
      ],
      "id": "73996afe-4f04-4465-a92f-2eb7f252e6e8",
      "name": "Message a model8",
      "credentials": {
        "googlePalmApi": {
          "id": "Gq3qNdXZmlzVb7Jg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "vamsikrishna2536@gmail.com",
        "subject": "New",
        "message": "Hai",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3344,
        -1200
      ],
      "id": "bd8a9f1b-d980-42aa-9489-153649433719",
      "name": "Send a message",
      "webhookId": "b4e5260d-8e91-44c0-9c4e-3caf8e6766de",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "vamsikrishna2536@gmail.com",
        "subject": "Hi",
        "message": "New",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3344,
        -1008
      ],
      "id": "1ac6cfd1-e1e8-49de-991d-6ccf225f4ce4",
      "name": "Send a message1",
      "webhookId": "38a734f6-773f-4fd0-a4d0-b12eb94e28f8",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "vamsikrishna2536@gmail.com",
        "subject": "Hi",
        "message": "New",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3312,
        -816
      ],
      "id": "d49d6457-3eb3-438b-9f8c-813bfbee4cad",
      "name": "Send a message4",
      "webhookId": "38a734f6-773f-4fd0-a4d0-b12eb94e28f8",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04",
          "mode": "list",
          "cachedResultName": "Lead Qualification System",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Websiteforms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IUNIvKOc2s6qmjwrMZLpuhgvvK_py2sXskapsOswS04/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Email",
              "lookupValue": "={{ $json.email }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3840,
        304
      ],
      "id": "e55e6f20-315d-4d31-b324-b10127a6cbb5",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "3MsYFPOz6gYs3lBk",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash-preview-09-2025",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash-preview-09-2025"
        },
        "messages": {
          "values": [
            {
              "content": "=# Lead Qualification Coach AI Prompt\n\nYou are a Lead Qualification AI Assistant that thinks like an experienced Coach.\n\nYour job is to classify leads using emotional signals, mindset, readiness, and seriousness, not just words.  \nYou must separate real coaching prospects from system messages, promotions, and weak inquiries.\n\n---\n\n## INPUT YOU WILL RECEIVE (JSON)\n\n```json\n{\n  \"name\": \"{{ $('Edit Req Fields for Email').item.json.name }}\",\n  \"email\": \"{{ $('Edit Req Fields for Email').item.json.email }}\",\n  \"snippet\": \"{{ $('Edit Req Fields for Email').item.json.snippet }}\",\n  \"problem_summary\": \"{{ $('Edit Req Fields for Email').item.json.problem_summary }}\",\n  \"need_type\": \"{{ $('Edit Req Fields for Email').item.json.need_type }}\",\n  \"readiness_level\": \"{{ $('Edit Req Fields for Email').item.json.readiness_level }}\",\n  \"lead_score\": \"{{ $('Edit Req Fields for Email').item.json.lead_score }}\",\n  \"coach_notes\": \"{{ $('Edit Req Fields for Email').item.json.coach_notes }}\"\n}\n```\n\n---\n\n## HOW TO THINK\n\nEvaluate the lead emotionally and logically using these five lenses:\n\n- Pain Depth: Is the problem emotional and specific, or vague and soft?\n- Ownership Level: Does the person take responsibility or shift blame?\n- Desire Strength: Do they truly want to change, or just complain?\n- Decision Readiness: Do they sound close to action or just thinking?\n- Coachability: Do they sound open to being helped?\n\n---\n\n## LEAD CLASSIFICATION RULES\n\n### HOT LEAD\nChoose Hot if most of the following are true:\n\n- The pain sounds emotionally real and urgent\n- The person accepts responsibility\n- The desire to change is strong\n- Readiness Level says Ready to Invest\n- The tone is open and solution focused\n\nExample:\n\"I need this fixed fast. I am ready to invest in the right mentor.\"\n\n---\n\n### WARM LEAD\nChoose Warm when:\n\n- The problem is real but not urgent\n- Readiness Level says Interested\n- They are curious and reflective\n- They do not show time pressure\n\nExample:\n\"I know this is a problem for me, and I want to understand my options.\"\n\n---\n\n### COLD LEAD\nChoose Cold when:\n\n- Pain sounds vague\n- Responsibility is weak\n- They show little urgency\n- Readiness Level says Exploring\n- Language is passive or casual\n\nExample:\n\"Just checking what you do.\"\n\n---\n\n### UNQUALIFIED LEAD\nChoose Unqualified when:\n\n- It is a system message, promo, or automated email\n- There is no human intent\n- The content has nothing to do with coaching\n\nExample:\n\"New login detected\"  \n\"Reset your password\"  \n\"Limited time offer\"\n\n---\n\n## OUTPUT FORMAT (STRICT JSON ONLY)\n\nReturn JSON and nothing else.\n\n```json\n{\n  \"name\": \"\",\n  \"email\": \"\",\n  \"lead_stage\": \"Hot | Warm | Cold | Unqualified\",\n  \"reason\": \"2 to 3 short lines explaining emotional and logical signals\",\n  \"coach_notes\": \"One clear action step for the coach\"\n}\n```\n\n---\n\n## RULES\n\n- Output JSON only\n- Do not include markdown\n- Do not repeat the input\n- Be decisive\n"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -4880,
        944
      ],
      "id": "0f779a05-5c7b-4564-b762-82e1ef1a6feb",
      "name": "Message a model1",
      "credentials": {
        "googlePalmApi": {
          "id": "Gq3qNdXZmlzVb7Jg",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json.email }}",
        "subject": "New Lead",
        "message": "=<html>\n  <body style=\"font-family: 'Segoe UI', Arial, sans-serif; background-color: #f8f9fb; padding: 20px;\">\n    <table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);\">\n      <tr>\n        <td style=\"padding: 30px; text-align: center;\">\n          <h2 style=\"color: #e63946;\">ðŸ”¥ Letâ€™s Chat â€” I Think I Can Help You!</h2>\n          <p style=\"color: #444; font-size: 16px; line-height: 1.6;\">\n            Hey {{ $json.name }},  \n            I just went through your note about <strong>{{ $json.problem_summary }}</strong> â€” and I can already see a few quick wins that can turn things around fast.\n          </p>\n          <p style=\"color: #444; font-size: 16px;\">\n            Letâ€™s connect for a short strategy call to dive in and map out a solution tailored for your business.\n          </p>\n\n          <a href=\"[calendar_link]\" \n             style=\"display:inline-block; background-color:#e63946; color:#fff; padding:12px 24px; \n                    border-radius:8px; text-decoration:none; font-weight:bold; margin-top:15px;\">\n            ðŸ“… Book Your Strategy Call\n          </a>\n\n          <p style=\"margin-top:25px; color:#777; font-size:14px;\">\n            Canâ€™t find a slot that fits? Just reply to this email and Iâ€™ll make one work for you.\n          </p>\n\n          <hr style=\"margin:30px 0; border:none; border-top:1px solid #eee;\">\n          <p style=\"font-size:13px; color:#aaa;\">\n            Sent by Lumoscale â€” helping coaches automate lead generation & onboarding.<br>\n            [coach_name]\n          </p>\n        </td>\n      </tr>\n    </table>\n  </body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3632,
        832
      ],
      "id": "1ade3dff-3355-45fc-bada-0b973c584894",
      "name": "Send a message5",
      "webhookId": "60502eb8-e3ed-409e-a9b8-7235cfc5885a",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json.email }}",
        "subject": "New Lead",
        "message": "=<html>\n  <body style=\"font-family: 'Segoe UI', Arial, sans-serif; background-color: #f8f9fb; padding: 20px;\">\n    <table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);\">\n      <tr>\n        <td style=\"padding: 30px; text-align: center;\">\n          <h2 style=\"color: #e63946;\">ðŸ”¥ Letâ€™s Chat â€” I Think I Can Help You!</h2>\n          <p style=\"color: #444; font-size: 16px; line-height: 1.6;\">\n            Hey {{ $json.name }},  \n            I just went through your note about <strong>{{ $json.problem_summary }}</strong> â€” and I can already see a few quick wins that can turn things around fast.\n          </p>\n          <p style=\"color: #444; font-size: 16px;\">\n            Letâ€™s connect for a short strategy call to dive in and map out a solution tailored for your business.\n          </p>\n\n          <a href=\"[calendar_link]\" \n             style=\"display:inline-block; background-color:#e63946; color:#fff; padding:12px 24px; \n                    border-radius:8px; text-decoration:none; font-weight:bold; margin-top:15px;\">\n            ðŸ“… Book Your Strategy Call\n          </a>\n\n          <p style=\"margin-top:25px; color:#777; font-size:14px;\">\n            Canâ€™t find a slot that fits? Just reply to this email and Iâ€™ll make one work for you.\n          </p>\n\n          <hr style=\"margin:30px 0; border:none; border-top:1px solid #eee;\">\n          <p style=\"font-size:13px; color:#aaa;\">\n            Sent by Lumoscale â€” helping coaches automate lead generation & onboarding.<br>\n            [coach_name]\n          </p>\n        </td>\n      </tr>\n    </table>\n  </body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3616,
        1008
      ],
      "id": "c70d69d3-e6f7-48be-9afd-a9f33da63f6a",
      "name": "Send a message6",
      "webhookId": "60502eb8-e3ed-409e-a9b8-7235cfc5885a",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json.email }}",
        "subject": "New Lead",
        "message": "=<html>\n  <body style=\"font-family: 'Segoe UI', Arial, sans-serif; background-color: #f8f9fb; padding: 20px;\">\n    <table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);\">\n      <tr>\n        <td style=\"padding: 30px; text-align: center;\">\n          <h2 style=\"color: #e63946;\">ðŸ”¥ Letâ€™s Chat â€” I Think I Can Help You!</h2>\n          <p style=\"color: #444; font-size: 16px; line-height: 1.6;\">\n            Hey {{ $json.name }},  \n            I just went through your note about <strong>{{ $json.problem_summary }}</strong> â€” and I can already see a few quick wins that can turn things around fast.\n          </p>\n          <p style=\"color: #444; font-size: 16px;\">\n            Letâ€™s connect for a short strategy call to dive in and map out a solution tailored for your business.\n          </p>\n\n          <a href=\"[calendar_link]\" \n             style=\"display:inline-block; background-color:#e63946; color:#fff; padding:12px 24px; \n                    border-radius:8px; text-decoration:none; font-weight:bold; margin-top:15px;\">\n            ðŸ“… Book Your Strategy Call\n          </a>\n\n          <p style=\"margin-top:25px; color:#777; font-size:14px;\">\n            Canâ€™t find a slot that fits? Just reply to this email and Iâ€™ll make one work for you.\n          </p>\n\n          <hr style=\"margin:30px 0; border:none; border-top:1px solid #eee;\">\n          <p style=\"font-size:13px; color:#aaa;\">\n            Sent by Lumoscale â€” helping coaches automate lead generation & onboarding.<br>\n            [coach_name]\n          </p>\n        </td>\n      </tr>\n    </table>\n  </body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3600,
        1200
      ],
      "id": "b8963194-4860-4d13-abc3-0472f4820f13",
      "name": "Send a message7",
      "webhookId": "60502eb8-e3ed-409e-a9b8-7235cfc5885a",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "thread",
        "operation": "get",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2896,
        -1280
      ],
      "id": "983a92bc-2148-46d3-9918-9f0693a4e72e",
      "name": "Get a thread",
      "webhookId": "ffc275cf-cc6b-49af-8833-7345addf4026",
      "credentials": {
        "gmailOAuth2": {
          "id": "OEcIZm1duf4dQunn",
          "name": "Gmail account 2"
        }
      }
    }
  ],
  "connections": {
    "Wait1": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Linkedin DM": {
      "main": [
        [
          {
            "node": "Edit req fields from Linkedin dm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit req fields from Linkedin dm": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Message a model5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet1": {
      "main": [
        [
          {
            "node": "Append Instagram Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append Instagram Sheet": {
      "main": [
        [
          {
            "node": "Send reply back in Instagram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Instagram DMs": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Append row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model5": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Append row in sheet5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet5": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Message a model7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model7": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Append or update row in sheet2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Append or update row in sheet2": {
      "main": [
        [
          {
            "node": "Send reply back in Linkedin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Website Signup or Webinar Signup": {
      "main": [
        [
          {
            "node": "Edit Req Fields for Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If duplicates Found vs Not Found": {
      "main": [
        [
          {
            "node": "Message a model8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Form Sheet 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check duplicates": {
      "main": [
        [
          {
            "node": "If duplicates Found vs Not Found",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Req Fields for Form": {
      "main": [
        [
          {
            "node": "Message a model4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Check duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Hot Slack Message",
            "type": "main",
            "index": 0
          },
          {
            "node": "Hot Lead",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hot Lead": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get a thread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Email For Every Min": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Req Fields for Email": {
      "main": [
        [
          {
            "node": "Duplicates in Gmail sheet1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Edit Req Fields for Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model2": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Message a model2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Duplicates in Gmail sheet1": {
      "main": [
        [
          {
            "node": "If duplicates Found vs Not Found - Instagram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If duplicates Found vs Not Found - Instagram1": {
      "main": [
        [
          {
            "node": "Message a model1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Gmail Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Send a message2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a message3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message2": {
      "main": [
        [
          {
            "node": "Append row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model4": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model8": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        []
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "If duplicates Found vs Not Found - Instagram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model1": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message5": {
      "main": [
        [
          {
            "node": "Append row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message6": {
      "main": [
        [
          {
            "node": "Append row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message7": {
      "main": [
        [
          {
            "node": "Append row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Linkedin DM": [
      {
        "json": {
          "headers": {
            "host": "n8n.srv1011051.hstgr.cloud",
            "user-agent": "axios/1.7.7",
            "content-length": "1209",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "51.159.195.149",
            "x-forwarded-host": "n8n.srv1011051.hstgr.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "91aa74ac8129",
            "x-real-ip": "51.159.195.149"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "message_received",
            "account_id": "m217EhgbTCeKm54r2Qw44w",
            "account_type": "LINKEDIN",
            "account_info": {
              "type": "LINKEDIN",
              "feature": "classic",
              "user_id": "ACoAAF6mS4gBFvo_nIYPRUS3l0w7CovUo3dLRrs"
            },
            "webhook_name": "n8n",
            "chat_id": "G00jx2pWWtGldT12TiyIig",
            "attendees": [
              {
                "attendee_id": "Sv1pL09yXh-xF7ZkMgsQEg",
                "attendee_provider_id": "ACoAAEdKhdYBtl0iugQy3sHdWvWgxGZ5HNBGgyU",
                "attendee_name": "Vadla Vamsi Krishna",
                "attendee_profile_url": "https://www.linkedin.com/in/ACoAAEdKhdYBtl0iugQy3sHdWvWgxGZ5HNBGgyU"
              }
            ],
            "sender": {
              "attendee_id": "Sv1pL09yXh-xF7ZkMgsQEg",
              "attendee_provider_id": "ACoAAEdKhdYBtl0iugQy3sHdWvWgxGZ5HNBGgyU",
              "attendee_name": "Vadla Vamsi Krishna",
              "attendee_profile_url": "https://www.linkedin.com/in/ACoAAEdKhdYBtl0iugQy3sHdWvWgxGZ5HNBGgyU"
            },
            "subject": null,
            "message": "Hi",
            "message_id": "y1Ag-bxBUrKEPghFblyEQg",
            "timestamp": "2025-10-30T19:11:19.753Z",
            "attachments": [],
            "provider_chat_id": "2-YWUyNDg5Y2EtMzc0YS00ODJjLWEzZWUtMGFlMzhmZjU3N2RmXzEwMA==",
            "provider_message_id": "2-MTc2MTg1MTQ3OTc1M2IxMTQ0My0xMDAmYWUyNDg5Y2EtMzc0YS00ODJjLWEzZWUtMGFlMzhmZjU3N2RmXzEwMA==",
            "is_event": 0,
            "quoted": null,
            "chat_content_type": null,
            "message_type": "MESSAGE",
            "is_group": false,
            "folder": [
              "INBOX",
              "INBOX_LINKEDIN_CLASSIC"
            ]
          },
          "webhookUrl": "https://n8n.srv1011051.hstgr.cloud/webhook-test/085371f4-fb8c-4ed1-a697-92ebd9e53bdd",
          "executionMode": "test"
        }
      }
    ],
    "Website Signup or Webinar Signup": [
      {
        "json": {
          "Name": "Vamsi",
          "Email": "vamsikrishna2536@gmail.com",
          "Whatsapp number": 91987654321,
          "Business type": "Agency",
          "Monthly revenue range": "2k",
          "What's your biggest challenge right now?": "Not getting enough leads",
          "How soon do you want to solve this": "Immediate",
          "What is your biggest goal in the next 90 days": "I want to close 3 deals and earn good revenue",
          "submittedAt": "2025-11-16T08:32:46.764+01:00",
          "formMode": "test"
        }
      }
    ],
    "Edit Req Fields for Form": [
      {
        "json": {
          "Name": "Vamsi",
          "Email": "vamsikrishna2536@gmail.com",
          "Whatsapp number": 91987654321,
          "Business type": "Agency",
          "Monthly revenue range": "2k",
          "What's your biggest challenge right now?": "Not getting enough leads",
          "How soon do you want to solve this": "Immediate",
          "What is your biggest goal in the next 90 days": "I want to close 3 deals and earn good revenue"
        }
      }
    ],
    "Edit Fields1": [
      {
        "json": {
          "name": "Vamsi",
          "email": "vamsikrishna2536@gmail.com",
          "lead_stage": "Hot",
          "reason": "Vamsi shows strong urgency with a clear problem and readiness to invest. Despite moderate pain intensity, the intent and ownership are high, with no victim language and a hopeful tone. These factors confirm a strong desire to change now.",
          "coach_notes": "Prioritize immediate engagement and offer tailored marketing strategies to convert quickly."
        }
      }
    ],
    "Message a model4": [
      {
        "json": {
          "content": {
            "parts": [
              {
                "text": "{\n  \"CorePain\": \"Not getting enough leads\",\n  \"NeedType\": \"sales\",\n  \"Emotion\": \"hopeful\",\n  \"PainIntensity\": 4,\n  \"CommittedWordsCount\": 1,\n  \"UrgencyFlag\": true,\n  \"ActionWordsCount\": 0,\n  \"VictimLanguage\": false,\n  \"RevenueScore\": 2,\n  \"IntentScore\": 4,\n  \"ClarityScore\": 3,\n  \"GoalQualityScore\": 4,\n  \"Notes\": \"Schedule strategy call\"\n}"
              }
            ],
            "role": "model"
          },
          "finishReason": "STOP",
          "index": 0
        }
      }
    ],
    "Code in JavaScript": [
      {
        "json": {
          "core_pain": "Not getting enough leads",
          "need_type": "sales",
          "emotion": "hopeful",
          "pain_intensity": 4,
          "committed_words": 1,
          "urgency_flag": true,
          "action_words": 0,
          "victim_language": false,
          "revenue_score": 2,
          "intent_score": 4,
          "clarity_score": 3,
          "goal_quality_score": 4,
          "coach_notes": "Schedule strategy call"
        }
      }
    ],
    "Edit Fields": [
      {
        "json": {
          "core_pain": "Not getting enough leads",
          "need_type": "sales",
          "emotion": "hopeful",
          "pain_intensity": 4,
          "committed_words": 1,
          "urgency_flag": true,
          "action_words": 0,
          "victim_language": false,
          "revenue_score": 2,
          "intent_score": 4,
          "clarity_score": 3,
          "goal_quality_score": 4,
          "coach_notes": "Schedule strategy call",
          "Name": "Vamsi",
          "Email": "vamsikrishna2536@gmail.com"
        }
      }
    ],
    "Code in JavaScript1": [
      {
        "json": {
          "name": "Vamsi",
          "email": "vamsikrishna2536@gmail.com",
          "lead_stage": "Hot",
          "reason": "Urgency flag is true and intent score is high, indicating a strong desire for a solution.",
          "coach_notes": "Schedule strategy call."
        }
      }
    ],
    "Check duplicates": [
      {
        "json": {}
      }
    ],
    "If duplicates Found vs Not Found": [
      {
        "json": {}
      }
    ],
    "Check Email For Every Min": [
      {
        "json": {
          "id": "19a927da1a760904",
          "threadId": "19a927da1a760904",
          "snippet": "Meet with Prity &lt;&gt; Vamsi Join with Google Meet â€“ You have been invited by Prity Kar to attend an event named Meet with Prity &lt;&gt; Vamsi on Monday Nov 17, 2025 â‹… 22:00 â€“ 22:30 (India Standard",
          "payload": {
            "mimeType": "multipart/mixed"
          },
          "sizeEstimate": 45692,
          "historyId": "373083",
          "internalDate": "1763394297000",
          "labels": [
            {
              "id": "INBOX",
              "name": "INBOX"
            },
            {
              "id": "IMPORTANT",
              "name": "IMPORTANT"
            },
            {
              "id": "CATEGORY_PERSONAL",
              "name": "CATEGORY_PERSONAL"
            },
            {
              "id": "UNREAD",
              "name": "UNREAD"
            }
          ],
          "Subject": "Invitation: Meet with Prity <> Vamsi @ Mon Nov 17, 2025 22:00 - 22:30 (IST) (vamsivk1465@gmail.com)",
          "From": "Prity Kar <prity@xpercentgrowth.com>",
          "To": "vamsivk1465@gmail.com"
        }
      }
    ],
    "Edit Fields2": [
      {
        "json": {
          "From": "Prity Kar <prity@xpercentgrowth.com>",
          "To": "vamsivk1465@gmail.com",
          "Subject": "Invitation: Meet with Prity <> Vamsi @ Mon Nov 17, 2025 22:00 - 22:30 (IST) (vamsivk1465@gmail.com)",
          "snippet": "Meet with Prity &lt;&gt; Vamsi Join with Google Meet â€“ You have been invited by Prity Kar to attend an event named Meet with Prity &lt;&gt; Vamsi on Monday Nov 17, 2025 â‹… 22:00 â€“ 22:30 (India Standard",
          "Received_at": "11/30/2025"
        }
      }
    ],
    "Message a model2": [
      {
        "json": {
          "content": {
            "parts": [
              {
                "text": "{\n  \"name\": \"Prity Kar\",\n  \"email\": \"prity@xpercentgrowth.com\",\n  \"problem_summary\": \"This is an automated calendar invitation for a meeting.\",\n  \"need_type\": \"other\",\n  \"readiness_level\": \"Exploring\",\n  \"lead_score\": \"1\",\n  \"coach_notes\": \"Ignore this email, it is only a calendar invitation.\"\n}"
              }
            ],
            "role": "model"
          },
          "finishReason": "STOP",
          "index": 0
        }
      }
    ],
    "Code in JavaScript2": [
      {
        "json": {
          "name": "Prity Kar",
          "email": "prity@xpercentgrowth.com",
          "problem_summary": "This is an automated calendar invitation for a meeting.",
          "need_type": "other",
          "readiness_level": "Exploring",
          "lead_score": 1,
          "coach_notes": "Ignore this email, it is only a calendar invitation."
        }
      }
    ],
    "Edit Req Fields for Email": [
      {
        "json": {
          "name": "Prity Kar",
          "email": "prity@xpercentgrowth.com",
          "problem_summary": "This is an automated calendar invitation for a meeting.",
          "need_type": "other",
          "readiness_level": "Exploring",
          "lead_score": 1,
          "coach_notes": "Ignore this email, it is only a calendar invitation.",
          "snippet": "Meet with Prity &lt;&gt; Vamsi Join with Google Meet â€“ You have been invited by Prity Kar to attend an event named Meet with Prity &lt;&gt; Vamsi on Monday Nov 17, 2025 â‹… 22:00 â€“ 22:30 (India Standard"
        }
      }
    ],
    "Message a model1": [
      {
        "json": {
          "content": {
            "parts": [
              {
                "text": "{\n  \"name\": \"Prity Kar\",\n  \"email\": \"prity@xpercentgrowth.com\",\n  \"lead_stage\": \"Unqualified\",\n  \"reason\": \"This is an automated calendar invitation, not a coaching inquiry. There are zero emotional signals, no stated problem, and no intent to seek help from a coach.\",\n  \"coach_notes\": \"Archive this lead immediately. It is a logistical system notification and not a genuine coaching prospect.\"\n}"
              }
            ],
            "role": "model"
          },
          "finishReason": "STOP",
          "index": 0
        }
      }
    ],
    "Code in JavaScript3": [
      {
        "json": {
          "name": "Prity Kar",
          "email": "prity@xpercentgrowth.com",
          "lead_stage": "Unqualified",
          "reason": "This is an automated calendar invitation, not a coaching inquiry. There are zero emotional signals, no stated problem, and no intent to seek help from a coach.",
          "coach_notes": "Archive this lead immediately. It is a logistical system notification and not a genuine coaching prospect."
        }
      }
    ],
    "Edit Fields3": [
      {
        "json": {
          "name": "Prity Kar",
          "email": "prity@xpercentgrowth.com",
          "snippet": null,
          "problem_summary": null,
          "need_type": null,
          "lead_score": null,
          "lead_stage": "Unqualified",
          "reason": "This is an automated calendar invitation, not a coaching inquiry. There are zero emotional signals, no stated problem, and no intent to seek help from a coach.",
          "coach_notes": "Archive this lead immediately. It is a logistical system notification and not a genuine coaching prospect."
        }
      }
    ],
    "Instagram DMs": [
      {
        "json": {
          "headers": {
            "host": "n8n.srv1011051.hstgr.cloud",
            "user-agent": "facebookexternalua",
            "content-length": "395",
            "accept": "*/*",
            "accept-encoding": "deflate, gzip",
            "content-type": "application/json",
            "instagram-api-version": "v24.0",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "n8n.srv1011051.hstgr.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "91aa74ac8129",
            "x-hub-signature": "sha1=21e544623436172b58d8f061ab687116e9c0fb02",
            "x-hub-signature-256": "sha256=5d3182073480b7c592e0754c85bb590ffabddda34f3ee48f74543d2887f41f55",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "object": "instagram",
            "entry": [
              {
                "time": 1764514660774,
                "id": "17841467996117515",
                "messaging": [
                  {
                    "sender": {
                      "id": "785204224427426"
                    },
                    "recipient": {
                      "id": "17841467996117515"
                    },
                    "timestamp": 1764514660212,
                    "message": {
                      "mid": "aWdfZAG1faXRlbToxOklHTWVzc2FnZAUlEOjE3ODQxNDY3OTk2MTE3NTE1OjM0MDI4MjM2Njg0MTcxMDMwMTI0NDI1OTY2MzAwMzQ3OTY4MzQ3NTozMjU0OTU1MDM1MTI0MTE0MTkzMzAwNDMzOTAzODY1MDM2OAZDZD",
                      "text": "Hello"
                    }
                  }
                ]
              }
            ]
          },
          "webhookUrl": "https://n8n.srv1011051.hstgr.cloud/webhook-test/Instagram-dm",
          "executionMode": "test"
        }
      }
    ]
  },
  "versionId": "fbfe34b6-1d7f-4b92-848d-8eb1d757fc35",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-10-30T15:52:31.745Z",
      "updatedAt": "2025-10-30T15:52:31.745Z",
      "role": "workflow:owner",
      "workflowId": "4aBnRQs0MwFenQHE",
      "projectId": "VDyoKZWt3i5eAZSO"
    }
  ],
  "tags": []
}